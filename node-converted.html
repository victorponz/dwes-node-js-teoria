<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>node</title>
<script src="https://kit.fontawesome.com/df26033572.js"></script>
<style type="text/css">html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none 0s ease 0s; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
svg[id^="mermaidChart"] { line-height: 1em; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
mark .md-meta { color: rgb(0, 0, 0); opacity: 0.3 !important; }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
  .typora-export h1::after, .typora-export h2::after, .typora-export h3::after, .typora-export h4::after, .typora-export h5::after, .typora-export h6::after { content: ""; display: block; height: 100px; margin-bottom: -100px; }
}


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; padding-bottom: 70px; white-space:inherit; overflow-x: visible; }
.first-line-indent #write p .md-line { text-indent: 0px; }
.first-line-indent #write li, .first-line-indent #write p, .first-line-indent #write p .md-line:first-child { text-indent: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write > blockquote:first-child, #write > div:first-child, #write > figure:first-child, #write > ol:first-child, #write > p:first-child, #write > pre:first-child, #write > ul:first-child { margin-top: 30px; }
#write li > figure:first-child { margin-top: -20px; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
h1, h2, h3, h4, h5, h6 { margin-top: 1rem; margin-bottom: 1rem; }
p { -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; }
.mathjax-block { margin-top: 0px; margin-bottom: 0px; -webkit-margin-before: 0px; -webkit-margin-after: 0px; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 80px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
pre { white-space: pre-wrap; }
pre.contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
.md-fences.mock-cm { white-space: pre-wrap; }
.show-fences-line-number .md-fences { padding-left: 0px; }
.show-fences-line-number .md-fences.mock-cm { padding-left: 40px; }
.CodeMirror-line { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
.footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 1cm; padding-right: 1cm; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > img:only-child { display: block; margin: auto; }
.md-line > .md-image:only-child, p > .md-image:only-child { display: inline-block; width: 100%; text-align: center; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.mathjax-block { white-space: pre; overflow: hidden; width: 100%; }
p + .mathjax-block { margin-top: -1.143rem; }
.mathjax-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, tt { font-family: var(--monospace); }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; }
a.md-print-anchor { border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.mathjax-block .MathJax_SVG_Display { text-align: center; margin: 1em 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: monospace; }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; z-index: 3; }
.CodeMirror-lines { padding: 4px 0px; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { margin-bottom: -30px; padding-bottom: 30px; height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow-y: hidden; overflow-x: scroll; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}
.CodeMirror-lint-markers { width: 16px; }
.CodeMirror-lint-tooltip { background-color: infobackground; border: 1px solid rgb(0, 0, 0); border-radius: 4px; color: infotext; font-family: var(--monospace); overflow: hidden; padding: 2px 5px; position: fixed; white-space: pre-wrap; z-index: 10000; max-width: 600px; opacity: 0; transition: opacity 0.4s; font-size: 0.8em; }
.CodeMirror-lint-mark-error, .CodeMirror-lint-mark-warning { background-position: left bottom; background-repeat: repeat-x; }
.CodeMirror-lint-mark-error { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAYAAAC09K7GAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sJDw4cOCW1/KIAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAHElEQVQI12NggIL/DAz/GdA5/xkY/qPKMDAwAADLZwf5rvm+LQAAAABJRU5ErkJggg=="); }
.CodeMirror-lint-marker-error, .CodeMirror-lint-marker-warning { background-position: center center; background-repeat: no-repeat; cursor: pointer; display: inline-block; height: 16px; width: 16px; vertical-align: middle; position: relative; }
.CodeMirror-lint-message-error, .CodeMirror-lint-message-warning { padding-left: 18px; background-position: left top; background-repeat: no-repeat; }
.CodeMirror-lint-marker-error, .CodeMirror-lint-message-error { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAHlBMVEW7AAC7AACxAAC7AAC7AAAAAAC4AAC5AAD///+7AAAUdclpAAAABnRSTlMXnORSiwCK0ZKSAAAATUlEQVR42mWPOQ7AQAgDuQLx/z8csYRmPRIFIwRGnosRrpamvkKi0FTIiMASR3hhKW+hAN6/tIWhu9PDWiTGNEkTtIOucA5Oyr9ckPgAWm0GPBog6v4AAAAASUVORK5CYII="); }
.CodeMirror-lint-marker-warning, .CodeMirror-lint-message-warning { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAANlBMVEX/uwDvrwD/uwD/uwD/uwD/uwD/uwD/uwD/uwD6twD/uwAAAADurwD2tQD7uAD+ugAAAAD/uwDhmeTRAAAADHRSTlMJ8mN1EYcbmiixgACm7WbuAAAAVklEQVR42n3PUQqAIBBFUU1LLc3u/jdbOJoW1P08DA9Gba8+YWJ6gNJoNYIBzAA2chBth5kLmG9YUoG0NHAUwFXwO9LuBQL1giCQb8gC9Oro2vp5rncCIY8L8uEx5ZkAAAAASUVORK5CYII="); }
.CodeMirror-lint-marker-multiple { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAMAAADzjKfhAAAACVBMVEUAAAAAAAC/v7914kyHAAAAAXRSTlMAQObYZgAAACNJREFUeNo1ioEJAAAIwmz/H90iFFSGJgFMe3gaLZ0od+9/AQZ0ADosbYraAAAAAElFTkSuQmCC"); background-repeat: no-repeat; background-position: right bottom; width: 100%; height: 100%; }


:root { --side-bar-bg-color: #fafafa; --control-text-color: #777; }
html { font-size: 16px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 20px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
body > :first-child { margin-top: 0px !important; }
body > :last-child { margin-bottom: 0px !important; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 2px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border: 0px none; overflow: hidden; box-sizing: content-box; }
body > h2:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child + h2 { margin-top: 0px; padding-top: 0px; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child { margin-top: 0px; padding-top: 0px; }
a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 { margin-top: 0px; padding-top: 0px; }
h1 p, h2 p, h3 p, h4 p, h5 p, h6 p { margin-top: 0px; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 4px solid rgb(223, 226, 229); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
table tr { border-top: 1px solid rgb(223, 226, 229); margin: 0px; padding: 0px; }
table tr:nth-child(2n), thead { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border-width: 1px 1px 0px; border-top-style: solid; border-right-style: solid; border-left-style: solid; border-top-color: rgb(223, 226, 229); border-right-color: rgb(223, 226, 229); border-left-color: rgb(223, 226, 229); border-image: initial; border-bottom-style: initial; border-bottom-color: initial; text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(223, 226, 229); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); }
.md-fences, code, tt { border: 1px solid rgb(223, 226, 229); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, "Liberation Mono", Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding: 8px 1em 6px; }
.md-task-list-item > input { margin-left: -1.3em; }
@media screen and (min-width: 914px) {
}
@media print {
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border-radius: 3px; font-family: Consolas, "Liberation Mono", Courier, monospace; padding: 2px 0px 0px 4px; font-size: 0.9em; color: inherit; }
.md-tag { color: inherit; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
.sidebar-tabs { border-bottom: none; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
#md-notification::before { top: 10px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.12); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }
.file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state { visibility: visible; }
.mac-seamless-mode #typora-sidebar { background-color: var(--side-bar-bg-color); }
.md-lang { color: rgb(180, 101, 77); }
.html-for-mac .context-menu { --item-hover-bg-color: #E6F0FE; }


.cm-s-inner { background-color: rgb(38, 50, 56); color: rgb(233, 237, 237); }
.cm-s-inner .CodeMirror-gutters { background: rgb(38, 50, 56); color: rgb(83, 127, 126); border: none; }
.cm-s-inner .CodeMirror-guttermarker, .cm-s-inner .CodeMirror-guttermarker-subtle, .cm-s-inner .CodeMirror-linenumber { color: rgb(83, 127, 126); }
.cm-s-inner .CodeMirror-cursor { border-left: 1px solid rgb(248, 248, 240); }
.cm-s-inner div.CodeMirror-selected { background: rgba(255, 255, 255, 0.15); }
.cm-s-inner.CodeMirror-focused div.CodeMirror-selected { background: rgba(255, 255, 255, 0.1); }
.cm-s-inner .CodeMirror-line::selection, .cm-s-inner .CodeMirror-line > span::selection, .cm-s-inner .CodeMirror-line > span > span::selection { background: rgba(255, 255, 255, 0.1); }
.cm-s-inner .CodeMirror-activeline-background { background: rgba(0, 0, 0, 0); }
.cm-s-inner .cm-keyword { color: rgb(199, 146, 234); }
.cm-s-inner .cm-operator { color: rgb(233, 237, 237); }
.cm-s-inner .cm-variable-2 { color: rgb(128, 203, 196); }
.cm-s-inner .cm-variable-3 { color: rgb(130, 177, 255); }
.cm-s-inner .cm-builtin { color: rgb(222, 203, 107); }
.cm-s-inner .cm-atom { color: rgb(247, 118, 105); }
.cm-s-inner .cm-number { color: rgb(247, 118, 105); }
.cm-s-inner .cm-def { color: rgb(233, 237, 237); }
.cm-s-inner .cm-string { color: rgb(195, 232, 141); }
.cm-s-inner .cm-string-2 { color: rgb(128, 203, 196); }
.cm-s-inner .cm-comment { color: rgb(84, 110, 122); }
.cm-s-inner .cm-variable { color: rgb(130, 177, 255); }
.cm-s-inner .cm-tag { color: rgb(128, 203, 196); }
.cm-s-inner .cm-meta { color: rgb(128, 203, 196); }
.cm-s-inner .cm-attribute { color: rgb(255, 203, 107); }
.cm-s-inner .cm-property { color: rgb(128, 203, 174); }
.cm-s-inner .cm-qualifier { color: rgb(222, 203, 107); }
.cm-s-inner .cm-variable-3 { color: rgb(222, 203, 107); }
.cm-s-inner .cm-tag { color: rgb(255, 83, 112); }
.cm-s-inner .cm-error { color: rgb(255, 255, 255); background-color: rgb(236, 95, 103); }
.cm-s-inner .CodeMirror-matchingbracket { text-decoration: underline; color: white !important; }
.md-fences { background-color: rgb(38, 50, 56); color: rgb(233, 237, 237); border: none; }
.md-fences .code-tooltip { background-color: rgb(38, 50, 56); }
.md-diagram-panel { font-family: Arial; font-size: 14px; line-height: 16px; }

.typora-export p, .typora-export .footnote-line {white-space: normal;} 
iframe{
awidth:auto;
}



</style>
<style type='text/css'>
body.typora-export{
    padding-left: 0;
    padding-right: 0;
    background-color: #f8f8f8;
}
#write-wrapper{
    margin:0px auto;
    margin-top: 80px;
    margin-bottom: 80px;
    max-width: 960px;
    background-color: #fff;
    box-shadow: 0 1px 0 rgba(255, 255, 255, 0),0 0 1Z0px rgba(0, 0, 0, 0.1);
    border: 1px solid #c2c2c2;
    
}
#write, #custom-footer{
    max-width: 100%;
}
#write{
	padding: 80px 80px 100px
}
.typora-menu  {
    left:0;
    position: fixed;
    top: 0;
    bottom: 0;
    z-index: 10;
    overflow-y: auto;
    width: 300px;
    color: #364149;
    background: #2c2c2c;
    border-right: 1px solid rgba(0,0,0,.07);
    -webkit-transition: left 250ms ease;
    -moz-transition: left 250ms ease;
    -o-transition: left 250ms ease;
    transition: left 250ms ease;
    opacity: .9;
}
.hide-menu .typora-menu{
    left:-300px;
}
.main-content{
    top: 0;
    right: 0;
    bottom: 0;
    overflow-y: auto;
    color: #000;
}
#nav-previous, #nav-next, .top a.toogle{
  -webkit-transition: left 250ms ease;
    -moz-transition: left 250ms ease;
    -o-transition: left 250ms ease;
    transition: left 250ms ease;
    background-color: #2c2c2c;
    opacity: .9;
}
.hide-menu #nav-previous, .hide-menu #nav-next, .hide-menu .top a.toogle{
    left: 0;
}

.hide-menu .main-content{
    margin-left:0px;
}

.md-toc-item a{
    display: block;
    padding: 4px 4px;
    border-bottom: none;
    color: #fafafa;
    background: 0 0;
    position: relative;
    outline: none;
}
.top{
    position: fixed;
    top:0;
    z-index: 4;
    width: 30%;
}

.top a.toogle{
    color:#c2c2c2;
    padding: 8px;
    height: 30px;
    left: 300px;
    position: fixed;
    padding-top:2px;
}
#nav-previous{
    color:#c2c2c2;
    padding: 8px;
    left: 300px;
    position: fixed;
    top: 30px;
    height: 30px;
    padding-top:2px;
}
#nav-next{
    color:#c2c2c2;
    padding: 8px;
    left: 300px;
    position: fixed;
    top: 60px;
    height: 30px;
    padding-top:2px;
}
.top a.toogle:hover, .top a.toogle:focus, #nav-previous:hover, #nav-next:hover, #nav-previous:focus, #nav-next:focus{
    color:rgb(65, 131, 196);
}
.md-toc-content a{
    border-left: 1px solid transparent;
}
.md-toc-content a.active{
    border-left: 1px solid #fafafa;
    color:rgb(65, 131, 196);
}
.md-toc-h1 .md-toc-inner{
    font-weight: inherit;
}
.md-toc-h2 .md-toc-inner{
    margin-left: 0.4em;
}
.md-toc-h3 .md-toc-inner{
    margin-left: 2em;
}
.md-toc-h4 .md-toc-inner{
    margin-left: 3em;
}
.md-toc-h5 .md-toc-inner{
    margin-left: 4em;
}
.md-toc-h6 .md-toc-inner{
    margin-left: 5em;
}

.md-toc-h1 a.md-toc-inner{
    font-size: 1.3rem;
}

.raw-code{
	cursor:pointer;
    position: absolute;
    top: -28px;
    right: 0;
    background-color: rgba(255, 255, 255, .8);
    padding: 2px 4px;
    border: 1px solid #263237;
    color: #263237;
}
.raw-code.hide{
	display:none;
}
.raw-code.show{
	display:inherit;
}
.typora-export p, .typora-export li {white-space: inherit;} 

</style>
 
</head>
<body class="typora-export">
<div class="typora-container">
  <div class="typora-menu"><div class="md-toc" mdtype="toc">
	<p class="md-toc-content"><span class='md-toc-item md-toc-h1'><a id='anchor-heading-0' title='Instalación de node' class="md-toc-inner active" style="cursor: pointer;" href="#instalación-de-node">Instalación de node</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-1' title='Nuestra primera aplicación en Node.js' class="md-toc-inner" style="cursor: pointer;" href="#nuestra-primera-aplicación-en-nodejs">Nuestra primera aplicación en Node.js</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-2' title='1 El modelo de ejecución de Node.js' class="md-toc-inner" style="cursor: pointer;" href="#1-el-modelo-de-ejecución-de-nodejs">1 El modelo de ejecución de Node.js</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-3' title='2 “Hello, World!” — Versión servidor' class="md-toc-inner" style="cursor: pointer;" href="#2-hello-world-----versión-servidor">2 “Hello, World!” — Versión servidor</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-4' title='3 Fundamentos de nuestra aplicación de notas' class="md-toc-inner" style="cursor: pointer;" href="#3-fundamentos-de-nuestra-aplicación-de-notas">3 Fundamentos de nuestra aplicación de notas</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-5' title='4 Guardar nuestras configuraciones' class="md-toc-inner" style="cursor: pointer;" href="#4-guardar-nuestras-configuraciones">4 Guardar nuestras configuraciones</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-6' title='5 Definir las rutas' class="md-toc-inner" style="cursor: pointer;" href="#5-definir-las-rutas">5 Definir las rutas</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-7' title='6 Crear los modelos' class="md-toc-inner" style="cursor: pointer;" href="#6-crear-los-modelos">6 Crear los modelos</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-8' title='6.1 Configurando la base de datos' class="md-toc-inner" style="cursor: pointer;" href="#61-configurando-la-base-de-datos">6.1 Configurando la base de datos</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-9' title='7 Creando nuestro modelo de nota' class="md-toc-inner" style="cursor: pointer;" href="#7-creando-nuestro-modelo-de-nota">7 Creando nuestro modelo de nota</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-10' title='8 Sincronizar la base de datos' class="md-toc-inner" style="cursor: pointer;" href="#8-sincronizar-la-base-de-datos">8 Sincronizar la base de datos</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-11' title='9 Crear los controladores' class="md-toc-inner" style="cursor: pointer;" href="#9-crear-los-controladores">9 Crear los controladores</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-12' title='9.1 El controlador Home' class="md-toc-inner" style="cursor: pointer;" href="#91-el-controlador-home">9.1 El controlador Home</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-13' title='9.2 Controlador para las Notas' class="md-toc-inner" style="cursor: pointer;" href="#92-controlador-para-las-notas">9.2 Controlador para las Notas</a></span>
<span class='md-toc-item md-toc-h4'><a id='anchor-heading-14' title='9.2.1 Create' class="md-toc-inner" style="cursor: pointer;" href="#921-create">9.2.1 Create</a></span>
<span class='md-toc-item md-toc-h4'><a id='anchor-heading-15' title='9.2.2 Read' class="md-toc-inner" style="cursor: pointer;" href="#922-read">9.2.2 Read</a></span>
<span class='md-toc-item md-toc-h4'><a id='anchor-heading-16' title='9.2.3 Update' class="md-toc-inner" style="cursor: pointer;" href="#923-update">9.2.3 Update</a></span>
<span class='md-toc-item md-toc-h4'><a id='anchor-heading-17' title='9.2.4 Delete' class="md-toc-inner" style="cursor: pointer;" href="#924-delete">9.2.4 Delete</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-18' title='10 Crear las vistas' class="md-toc-inner" style="cursor: pointer;" href="#10-crear-las-vistas">10 Crear las vistas</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-19' title='10.1 El componente Note' class="md-toc-inner" style="cursor: pointer;" href="#101-el-componente-note">10.1 El componente Note</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-20' title='10.2 El layout base' class="md-toc-inner" style="cursor: pointer;" href="#102-el-layout-base">10.2 El layout base</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-21' title='10.3 La vista Home' class="md-toc-inner" style="cursor: pointer;" href="#103-la-vista-home">10.3 La vista Home</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-22' title='10.4 La vista Note' class="md-toc-inner" style="cursor: pointer;" href="#104-la-vista-note">10.4 La vista Note</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-23' title='10.5 Javascript en el cliente' class="md-toc-inner" style="cursor: pointer;" href="#105-javascript-en-el-cliente">10.5 Javascript en el cliente</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-24' title='11 Añadir soporte para vistas en el servidor' class="md-toc-inner" style="cursor: pointer;" href="#11-añadir-soporte-para-vistas-en-el-servidor">11 Añadir soporte para vistas en el servidor</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-25' title='11.1 Configuración de la vista de inicio' class="md-toc-inner" style="cursor: pointer;" href="#111-configuración-de-la-vista-de-inicio">11.1 Configuración de la vista de inicio</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-26' title='11.2 Configuración de la vista de Nota:create' class="md-toc-inner" style="cursor: pointer;" href="#112-configuración-de-la-vista-de-notacreate">11.2 Configuración de la vista de Nota:create</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-27' title='11.3 Servir archivos estáticos' class="md-toc-inner" style="cursor: pointer;" href="#113-servir-archivos-estáticos">11.3 Servir archivos estáticos</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-28' title='11.4 Configuración de la vista de Note:read' class="md-toc-inner" style="cursor: pointer;" href="#114-configuración-de-la-vista-de-noteread">11.4 Configuración de la vista de Note:read</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-29' title='11.5 Configuración de la vista de Note:update' class="md-toc-inner" style="cursor: pointer;" href="#115-configuración-de-la-vista-de-noteupdate">11.5 Configuración de la vista de Note:update</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-30' title='11.6 Configuración de la vista de Note:delete' class="md-toc-inner" style="cursor: pointer;" href="#116-configuración-de-la-vista-de-notedelete">11.6 Configuración de la vista de Note:delete</a></span>
</p></div></div>
  <div class="typora-export  main-content">
  <div class='top'>
    <a class='toogle expanded pull-left js-toolbar-action' aria-label='' href='#'><i class='fas fa-align-justify'></i></a>
    <a class='' href='#' id='nav-previous'><i class='fas fa-angle-double-left'></i></a>
    <a class='' href='#' id='nav-next'><i class='fas fa-angle-double-right'></i></a>
  </div>
    <div id='write-wrapper'>
      <div id='custom-header'>
        <!--put here your custom header -->
       </div>
       <div id="write" class="">
<p> </p>
<p><span>Poner en el aula virtual package.json y package.lock</span></p>
<h1 id="heading-0">
<a name="instalaci%C3%B3n-de-node" class="md-header-anchor"></a><span>Instalación de node</span>
</h1>
<p><span>Para instalar </span><code>node.js</code><span> </span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt install nodejs</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>Y para instalar el gestor de paquetes </span><code>nmp</code><span> </span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt install npm</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>Además vamos a instalar </span><code>nodemon</code><span>  para que rearranque automáticamente el servidor al realizar cualquier cambio en un archivo de la aplicación.</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99609px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo npm install -g nodemon</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<h2 id="heading-1">
<a name="nuestra-primera-aplicaci%C3%B3n-en-nodejs" class="md-header-anchor"></a><span>Nuestra primera aplicación en Node.js</span>
</h2>
<p><span>Crea un fichero llamado </span><code>hello.js</code><span> con el siguiente contenido:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99744px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-string">"Hello, World!"</span>);</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>Esto utiliza el módulo de consola integrado de </span><code>Node.js</code><span> para mostrar un mensaje en un terminal. Para ejecutar el ejemplo, escribe el siguiente comando:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99738px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">node hello.js</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>Si todo está correctamente instalado, producirá la siguiente salida:</span></p>
<blockquote><p><span>Hello, World!</span></p></blockquote>
<h2 id="heading-2">
<a name="1-el-modelo-de-ejecuci%C3%B3n-de-nodejs" class="md-header-anchor"></a><span>1 El modelo de ejecución de Node.js</span>
</h2>
<p><span>En términos muy simplistas, cuando se conecta a un servidor tradicional, como Apache, generará un nuevo hilo para manejar la solicitud. En un lenguaje como PHP o Ruby, cualquier operación de E/S subsiguiente (por ejemplo, interactuar con un base de datos) bloquea la ejecución de tu código hasta que la operación haya finalizado. Es decir, el servidor debe esperar a que se complete la búsqueda de la base de datos antes de poder pasar a procesar el resultado. Si llegan nuevas solicitudes mientras esto está sucediendo, el servidor generará nuevos hilos para tratar con ellos. Esto es potencialmente ineficiente, ya que una gran cantidad de subprocesos puede hacer que un sistema se vuelva lento y, en el peor de los casos, que el sitio caiga. La forma más común de admitir más conexiones es agregar más servidores.</span></p>
<p><code>Node.js</code><span>, sin embargo, es de un solo hilo. También está dirigido por eventos, lo que significa que todo lo que sucede en </span><code>Node</code><span> es una reacción a un evento. Por ejemplo, cuando un llega una nueva solicitud (un tipo de evento) el servidor comenzará a procesarla. Si luego encuentra una operación de bloqueo de E/S, en lugar de esperar a que esta se complete, registrará una devolución de llamada antes de continuar procesando el próximo evento. Cuando la operación de E/S ha finalizado (otro tipo de evento), el servidor ejecutará la devolución de llamada (callback) y continuará trabajando en la solicitud original. Entre bambalinas, Node utiliza la biblioteca </span><strong><span>libuv</span></strong><span> para implementar este comportamiento asíncrono (es decir, sin bloqueo).</span></p>
<p><span>El modelo de ejecución de Node causa al servidor una pequeña sobrecarga y, por lo tanto, es capaz de manejar un gran número de conexiones simultáneas. El enfoque tradicional para escalar una aplicación Node es clonarlo y hacer que las instancias clonadas compartan la carga de trabajo. Node.js incluso tiene un módulo incorporado para ayudarlo a implementar una estrategia de clonación en un solo servidor.</span></p>
<p><span>La siguiente imagen muestra el modelo de ejecución de Node:</span></p>
<p><img src="assets/1549267610868.png" referrerpolicy="no-referrer" alt="1549267610868"></p>
<p> </p>
<p><strong><span>¿Hay desventajas?</span></strong></p>
<p><span>El hecho de que Node se ejecute en un solo hilo impone algunas limitaciones. Por ejemplo, se debe evitar el bloqueo de llamadas de E/S y los errores siempre deben manejarse correctamente ya que de lo contrario falla todo el proceso (es decir, el servidor se cae). A algunos desarrolladores también les disgusta el estilo de codificación basado en la devolución de llamada que impone JavaScript (hasta el punto de que incluso hay un sitio dedicado a los </span><a href="http://callbackhell.com/"><span>horrores de escribir JavaScript asíncrono</span></a><span>). Pero con la llegada de las promesas nativas, seguidas de cerca por </span><code>async await</code><span> (que está habilitada de forma predeterminada a partir de la versión 7.6 de Node), esto se está convirtiendo rápidamente en una cosa del pasado.</span></p>
<h2 id="heading-3">
<a name="2-hello-world-----versi%C3%B3n-servidor" class="md-header-anchor"></a><span>2 “Hello, World!” — Versión servidor</span>
</h2>
<p><span>Vamos a ver un ejemplo básico de un servidor:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">http</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'http'</span>);</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">http</span>.<span class="cm-property">createServer</span>((<span class="cm-def">request</span>, <span class="cm-def">response</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable-2">response</span>.<span class="cm-property">writeHead</span>(<span class="cm-number">200</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable-2">response</span>.<span class="cm-property">end</span>(<span class="cm-string">'Hello, World!'</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}).<span class="cm-property">listen</span>(<span class="cm-number">3000</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-string">'Server running on http://localhost:3000'</span>);</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 143px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 143px;"></div>
</div>
</div></pre>
<p><span>Para ejecutar esto, copia el código en un archivo llamado </span><code>hello-world-server.js</code><span> y ejecútalo usando </span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99731px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">node hello-world-server.js</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>Abre un navegador y navega a </span><a href="http://localhost:3000" target="_blank" class="url">http://localhost:3000</a><span> para ver "Hello, World!" en el navegador.</span></p>
<p><strong><span>Ahora echemos un vistazo al código.</span></strong></p>
<ol start="">
<li>
<span>Comenzamos requiriendo el módulo </span><code>HTTP</code><span> nativo de Node. Luego usamos su método </span><code>createServer</code><span> para crear un nuevo objeto de servidor web, al que le pasamos una función anónima. Esta función se invocará para cada nueva conexión que se realice al servidor.</span>
</li>
<li>
<span>La función anónima se llama con dos argumentos (</span><code>request</code><span> y </span><code>response</code><span>) que contienen la solicitud del usuario y la respuesta, que usamos para devolver un código de estado </span><code>HTTP 200</code><span>, junto con nuestro mensaje "Hello, World!".</span>
</li>
<li>
<span>Finalmente, le pedimos al servidor que escuche las solicitudes entrantes en el puerto </span><strong><span>3000</span></strong><span> y envíe un mensaje al terminal para informarnos que se está ejecutando.</span>
</li>
</ol>
<p><span>Obviamente, hay mucho más para crear incluso un servidor simple en Node (por ejemplo, es importante manejar los errores correctamente), por lo que te recomiendo que consultes la </span><a href="https://nodejs.org/en/docs/guides/anatomy-of-an-http-transaction/"><span>documentación</span></a><span> si deseas obtener más información.</span></p>
<h2 id="heading-4">
<a name="3-fundamentos-de-nuestra-aplicaci%C3%B3n-de-notas" class="md-header-anchor"></a><span>3 Fundamentos de nuestra aplicación de notas</span>
</h2>
<video src="./assets/notas.m4v" controls="controls"></video><p><span>Vamos a construir la funcionalidad básica de una aplicación para tomar notas usando la arquitectura MVC. Vamos a utilizar el framework de </span><a href="https://hapijs.com/"><span>Hapi.js</span></a><span> para Node.js y </span><a href="https://www.sqlite.org/index.html"><span>SQLite</span></a><span> como base de datos, utilizando </span><a href="https://sequelize.readthedocs.io/en/v3/"><span>Sequelize.js</span></a><span>, además de otras pequeñas utilidades para acelerar nuestro desarrollo. Vamos a construir las vistas usando </span><a href="https://pugjs.org/api/getting-started.html"><span>Pug</span></a><span>, el lenguaje de las plantillas.</span></p>
<p><span>El primer paso al crear cualquier aplicación Node.js es crear un archivo </span><code>package.json</code><span>, que contendrá todas nuestras dependencias y scripts. En lugar de crear este archivo manualmente, </span><code>npm</code><span> puede hacer el trabajo por nosotros usando el comando </span><code>init</code><span>:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">npm init -y</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>El contenido del archivo es el siguiente:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="json" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="json">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 3.99738px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-string cm-property">"name"</span>: <span class="cm-string">"dwes-node-js"</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-string cm-property">"version"</span>: <span class="cm-string">"1.0.0"</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-string cm-property">"description"</span>: <span class="cm-string">""</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-string cm-property">"main"</span>: <span class="cm-string">"hello-word-server.js"</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-string cm-property">"scripts"</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-string cm-property">"test"</span>: <span class="cm-string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-string cm-property">"repository"</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-string cm-property">"type"</span>: <span class="cm-string">"git"</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-string cm-property">"url"</span>: <span class="cm-string">"git+https://github.com/victorponz/dwes-node-js.git"</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-string cm-property">"keywords"</span>: [],</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-string cm-property">"author"</span>: <span class="cm-string">""</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-string cm-property">"license"</span>: <span class="cm-string">"ISC"</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-string cm-property">"bugs"</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-string cm-property">"url"</span>: <span class="cm-string">"https://github.com/victorponz/dwes-node-js/issues"</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-string cm-property">"homepage"</span>: <span class="cm-string">"https://github.com/victorponz/dwes-node-js#readme"</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 458px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 458px;"></div>
</div>
</div></pre>
<p><span>Vamos a proceder a instalar </span><code>Hapi.js</code><span>, el framework de elección para este tutorial. Proporciona un buen equilibrio entre simplicidad, estabilidad y disponibilidad de funciones que funcionará bien para nuestro caso de uso (aunque hay otras opciones que también funcionarán bien).</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">npm install --save hapi</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>Este comando descargará la última versión de </span><code>Hapi.js</code><span> y la agregará a nuestro archivo </span><code>package.json</code><span> como una dependencia.</span></p>
<p><span>Ahora podemos crear nuestro archivo de entrada, el servidor web que iniciará todo. Continúa y crea un archivo </span><code>server.js</code><span> en tu directorio de aplicación y con todo el siguiente código:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Hapi</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'hapi'</span>);</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Settings</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'./settings'</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">server</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Hapi</span>.<span class="cm-property">Server</span>({ <span class="cm-property">port</span>: <span class="cm-variable">Settings</span>.<span class="cm-property">port</span> });</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">server</span>.<span class="cm-property">route</span>({</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">method</span>: <span class="cm-string">'GET'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">path</span>: <span class="cm-string">'/'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">handler</span>: (<span class="cm-def">request</span>, <span class="cm-def">h</span>) <span class="cm-operator">=&gt;</span> <span class="cm-string">'Hello, World!'</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">});</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">init</span> <span class="cm-operator">=</span> <span class="cm-keyword">async</span> () <span class="cm-operator">=&gt;</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">await</span> <span class="cm-variable">server</span>.<span class="cm-property">start</span>();</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-string-2">`Server running at: ${</span><span class="cm-variable">server</span>.<span class="cm-property">info</span>.<span class="cm-property">uri</span><span class="cm-string-2">}`</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">process</span>.<span class="cm-property">on</span>(<span class="cm-string">'unhandledRejection'</span>, (<span class="cm-def">err</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable-2">err</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">process</span>.<span class="cm-property">exit</span>(<span class="cm-number">1</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">});</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">init</span>();</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 391px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 391px;"></div>
</div>
</div></pre>
<p><span>Esta será la base de nuestra aplicación.</span></p>
<ol start="">
<li>
<span>Primero, incluimos nuestras dependencias y creamos una instancia de un nuevo objeto de servidor donde configuramos el puerto de conexión a lo que declaremos en nuestro archivo de configuración. Usaremos el puerto </span><strong><span>3000</span></strong><span> aunque este puede ser cualquier número por encima de </span><strong><span>1023</span></strong><span> y por debajo de </span><strong><span>65535</span></strong><span>. </span>
<span>La primera ruta para nuestro servidor funcionará como una prueba para ver si todo funciona, por lo que un mensaje de "Hello, World!" es suficiente para nosotros.</span>
</li>
<li>
<span>En cada ruta, tenemos que definir el método HTTP y la ruta (URL) a la que responderá, así como un controlador, que es una función que procesará la solicitud HTTP. La función de manejador puede tomar dos parámetros. La primera, </span><code>request</code><span>, contiene información sobre la llamada HTTP. El segundo es algo que se llama el kit de herramientas de respuesta (</span><a href="https://hapijs.com/api/#response-toolkit"><span>response toolkit</span></a><span>), un objeto que contiene propiedades y utilidades para cuidar la respuesta. Este parámetro a menudo se reduce a </span><code>h</code><span>.</span>
</li>
<li>
<span>A continuación, creamos una función asíncrona desde la cual podemos iniciar nuestro servidor usando el método </span><code>server.start</code><span>. Luego, registramos un mensaje en la consola que indica que el servidor se está ejecutando e incluimos un código básico de manejo de errores, antes de iniciar el proceso llamando al método </span><code>init</code><span>.</span>
</li>
</ol>
<h2 id="heading-5">
<a name="4-guardar-nuestras-configuraciones" class="md-header-anchor"></a><span>4 Guardar nuestras configuraciones</span>
</h2>
<p><span>Es una buena práctica almacenar nuestras variables de configuración en un archivo dedicado. Este archivo exporta un objeto JSON que contiene nuestros datos, donde cada clave se asigna desde una variable de entorno, pero sin olvidar un valor de reserva. En este archivo, también podemos tener diferentes configuraciones dependiendo de nuestro entorno (por ejemplo, desarrollo o producción). Por ejemplo, podemos tener una instancia en memoria de SQLite para fines de desarrollo, pero un archivo de base de datos real de SQLite para producción.</span></p>
<p><span>Seleccionar los ajustes en función del entorno actual es bastante simple. Ya que también tenemos una variable </span><code>env</code><span> en nuestro archivo que contendrá desarrollo o producción, podemos hacer algo como lo siguiente para obtener la configuración de la base de datos (por ejemplo):</span></p>
<p><span>Crea un archivo </span><code>settings.js</code><span> en la raíz del proyecto y agrega el siguiente código:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99609px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// Uncomment the next line to load our .env file and add the values to process.env</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// require('dotenv').config({ silent: true });</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">module</span>.<span class="cm-property">exports</span> <span class="cm-operator">=</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">port</span>: <span class="cm-variable">process</span>.<span class="cm-property">env</span>.<span class="cm-property">PORT</span> <span class="cm-operator">||</span> <span class="cm-number">3000</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">env</span>: <span class="cm-variable">process</span>.<span class="cm-property">env</span>.<span class="cm-property">ENV</span> <span class="cm-operator">||</span> <span class="cm-string">'development'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">// Environment-dependent settings</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">development</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-property">db</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-property">dialect</span>: <span class="cm-string">'sqlite'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-property">storage</span>: <span class="cm-string">':memory:'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-property">operatorsAliases</span>: <span class="cm-atom">false</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">production</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-property">db</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-property">dialect</span>: <span class="cm-string">'sqlite'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-property">storage</span>: <span class="cm-string">'db/database.sqlite'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-property">operatorsAliases</span>: <span class="cm-atom">false</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 482px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 482px;"></div>
</div>
</div></pre>
<p><span>Ahora podemos iniciar nuestra aplicación ejecutando el siguiente comando y navegando a </span><a href="http://localhost:3000" target="_blank" class="url">http://localhost:3000</a><span> en nuestro navegador web.</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99741px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">nodemon server.js</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<h2 id="heading-6">
<a name="5-definir-las-rutas" class="md-header-anchor"></a><span>5 Definir las rutas</span>
</h2>
<p><span>La definición de rutas nos da una visión general de la funcionalidad admitida por nuestra aplicación. Para crear nuestras rutas adicionales, solo tenemos que replicar la estructura de la ruta que ya tenemos en nuestro archivo </span><code>server.js</code><span>, cambiando el contenido de cada una.</span></p>
<p><span>Comencemos creando un nuevo directorio llamado </span><strong><span>lib</span></strong><span> en nuestro proyecto. Aquí vamos a incluir todos los componentes de JS. Dentro de </span><strong><span>lib</span></strong><span>, creamos un archivo </span><code>routes.js</code><span> y agregamos el siguiente contenido:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">module</span>.<span class="cm-property">exports</span> <span class="cm-operator">=</span> [</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// Aquí definiremos las rutas</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">];</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 76px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 76px;"></div>
</div>
</div></pre>
<p><span>En este archivo, exportaremos un array de objetos que contiene cada ruta de nuestra aplicación. Para definir la primera ruta, agrega el siguiente objeto al array:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 3.99738px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">method</span>: <span class="cm-string">'GET'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">path</span>: <span class="cm-string">'/'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">handler</span>: (<span class="cm-def">request</span>, <span class="cm-def">h</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-keyword">return</span> <span class="cm-string">'All the notes will appear here'</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">config</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">description</span>: <span class="cm-string">'Gets all the notes available'</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">},</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 233px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 233px;"></div>
</div>
</div></pre>
<p><span>Nuestra primera ruta es para la página de inicio (</span><code>/</code><span>) y como solo devolverá información, le asignamos un método </span><code>GET</code><span>. Por ahora, solo nos dará el mensaje. Todas las notas aparecerán aquí, las cuales cambiaremos más adelante para una función de controlador. El campo de descripción en la sección de configuración es solo para fines de documentación.</span>
<span>A continuación, podemos crear las cuatro rutas para nuestras notas en la ruta </span><code>/note/</code><span>. Dado que estamos construyendo una aplicación </span><a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete"><span>CRUD</span></a><span>, necesitaremos una ruta para cada acción con el </span><a href="https://www.w3schools.com/tags/ref_httpmethods.asp"><span>método HTTP</span></a><span> correspondiente.</span></p>
<p><span>Añade las siguientes definiciones a la ruta anterior:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99609px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    {</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">method</span>: <span class="cm-string">'POST'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">path</span>: <span class="cm-string">'/note'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">handler</span>: (<span class="cm-def">request</span>, <span class="cm-def">h</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-keyword">return</span> <span class="cm-string">'New note'</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">config</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-variable">description</span>: <span class="cm-string">'Adds a new note'</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">method</span>: <span class="cm-string">'GET'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">path</span>: <span class="cm-string">'/note/{slug}'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">handler</span>: (<span class="cm-def">request</span>, <span class="cm-def">h</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-keyword">return</span> <span class="cm-string">'This is a note'</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">config</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-variable">description</span>: <span class="cm-string">'Gets the content of a note'</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">method</span>: <span class="cm-string">'PUT'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">path</span>: <span class="cm-string">'/note/{slug}'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">handler</span>: (<span class="cm-def">request</span>, <span class="cm-def">h</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-keyword">return</span> <span class="cm-string">'Edit a note'</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">config</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-variable">description</span>: <span class="cm-string">'Updates the selected note'</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">method</span>: <span class="cm-string">'DELETE'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">path</span>: <span class="cm-string">'/note/{slug}'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">handler</span>: (<span class="cm-def">request</span>, <span class="cm-def">h</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-keyword">return</span> <span class="cm-string">'This note no longer exists'</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">config</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-variable">description</span>: <span class="cm-string">'Deletes the selected note'</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 908px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 908px;"></div>
</div>
</div></pre>
<p><span>Hemos hecho lo mismo que en la definición de ruta anterior, pero esta vez hemos cambiado el método para que coincida con la acción que queremos ejecutar.</span></p>
<p><span>Podemos nombrar parámetros en la ruta rodeando la palabra entre corchetes </span><code>{...}</code><span>. Como vamos a identificar las notas por un </span><a href="https://prettylinks.com/2018/03/url-slugs/"><span>slug</span></a><span>, agregamos </span><code>{slug}</code><span> a cada ruta, con la excepción de la ruta </span><code>PUT</code><span>. No lo necesitamos allí, porque no vamos a interactuar con una nota específica, sino a crear una.</span></p>
<p><span>Puedes leer más sobre las rutas de Hapi.js en la </span><a href="https://hapijs.com/tutorials/routing"><span>documentación oficial</span></a><span>.</span></p>
<p><span>Ahora, tenemos que agregar nuestras nuevas rutas al archivo </span><code>server.js</code><span>. Importamos el archivo de rutas en la parte superior del archivo:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99707px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Routes</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'./lib/routes'</span>);</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>y reemplaza nuestra ruta de prueba actual con lo siguiente:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99738px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">server</span>.<span class="cm-property">route</span>(<span class="cm-variable">Routes</span>);</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>Para verificar que las cosas funcionan, reinicia el servidor y luego intenta visitar un par de las nuevas rutas </span><code>GET</code><span>: </span><a href="http://localhost:3000/" target="_blank" class="url">http://localhost:3000/</a><span> o </span><a href="http://localhost:3000/note/1" target="_blank" class="url">http://localhost:3000/note/1</a><span> </span></p>
<p><span>El resto de rutas las probaremos más adelante con </span><a href="https://www.getpostman.com/"><span>Postman</span></a></p>
<h2 id="heading-7">
<a name="6-crear-los-modelos" class="md-header-anchor"></a><span>6 Crear los modelos</span>
</h2>
<p><span>Los modelos nos permiten definir la estructura de los datos y todas las funciones para trabajar con ellos.</span>
<span>En este ejemplo, vamos a utilizar la base de datos </span><code>SQLite</code><span> con </span><code>Sequelize.js</code><span>, que nos proporcionará una mejor interfaz mediante la técnica </span><strong><span>ORM</span></strong><span> (Mapeo Relacional de Objetos). También nos proporcionará una interfaz independiente de la base de datos.</span></p>
<h3 id="heading-8">
<a name="61-configurando-la-base-de-datos" class="md-header-anchor"></a><span>6.1 Configurando la base de datos</span>
</h3>
<p><span>Para esta sección, vamos a utilizar los paquetes </span><code>Sequelize.js</code><span> y </span><code>SQlite</code><span>. Puedes instalarlos e incluirlos como dependencias ejecutando el siguiente comando:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99609px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">npm install -s sequelize sqlite3</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>Ahora crea un directorio de modelos </span><code>models</code><span> dentro del directorio </span><code>lib</code><span> y agrega un archivo llamado </span><code>index.js</code><span>. Esto contendrá la base de datos y la configuración de </span><code>Sequelize.js</code><span>. Agrega el siguiente contenido:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99609px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><span><span>​</span>x</span></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Fs</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'fs'</span>);</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Path</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'path'</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Sequelize</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'sequelize'</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Settings</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'../../settings'</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// Database settings for the current environment</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">dbSettings</span> <span class="cm-operator">=</span> <span class="cm-variable">Settings</span>[<span class="cm-variable">Settings</span>.<span class="cm-property">env</span>].<span class="cm-property">db</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">sequelize</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Sequelize</span>(</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">dbSettings</span>.<span class="cm-property">database</span>, <span class="cm-variable">dbSettings</span>.<span class="cm-property">user</span>, <span class="cm-variable">dbSettings</span>.<span class="cm-property">password</span>, <span class="cm-variable">dbSettings</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">db</span> <span class="cm-operator">=</span> {};</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// Read all the files in this directory and import them as models</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Fs</span>.<span class="cm-property">readdirSync</span>(<span class="cm-variable">__dirname</span>)</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    .<span class="cm-property">filter</span>(<span class="cm-def">file</span> <span class="cm-operator">=&gt;</span> (<span class="cm-variable-2">file</span>.<span class="cm-property">indexOf</span>(<span class="cm-string">'.'</span>) <span class="cm-operator">!==</span> <span class="cm-number">0</span>) <span class="cm-operator">&amp;&amp;</span> (<span class="cm-variable-2">file</span> <span class="cm-operator">!==</span> <span class="cm-string">'index.js'</span>))</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    .<span class="cm-property">forEach</span>((<span class="cm-def">file</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">const</span> <span class="cm-def">model</span> <span class="cm-operator">=</span> <span class="cm-variable">sequelize</span>.<span class="cm-property">import</span>(<span class="cm-variable">Path</span>.<span class="cm-property">join</span>(<span class="cm-variable">__dirname</span>, <span class="cm-variable-2">file</span>));</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">db</span>[<span class="cm-variable-2">model</span>.<span class="cm-property">name</span>] <span class="cm-operator">=</span> <span class="cm-variable-2">model</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    });</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">db</span>.<span class="cm-property">sequelize</span> <span class="cm-operator">=</span> <span class="cm-variable">sequelize</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">db</span>.<span class="cm-property">Sequelize</span> <span class="cm-operator">=</span> <span class="cm-variable">Sequelize</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">module</span>.<span class="cm-property">exports</span> <span class="cm-operator">=</span> <span class="cm-variable">db</span>;</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 482px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 482px;"></div>
</div>
</div></pre>
<ol start="">
<li>
<p><span>Incluimos los módulos que vamos a utilizar:</span></p>
<ul>
<li>
<code>Fs</code><span>, para leer los archivos dentro de la carpeta de modelos, que contendrá todos los modelos.</span>
</li>
<li>
<code>Path</code><span>, para unir la ruta de cada archivo en el directorio actual.</span>
</li>
<li>
<code>Sequelize</code><span>, que nos permitirá crear una nueva instancia de Sequelize.</span>
</li>
<li>
<code>Settings</code><span>, que contiene los datos de nuestro archivo </span><code>settings.js</code><span> desde la raíz de nuestro proyecto.</span>
</li>
</ul>
</li>
<li><p><span>A continuación, creamos una nueva variable de </span><code>Sequelize</code><span> que contendrá una instancia de </span><code>Sequelize</code><span> con nuestra configuración de base de datos para el entorno actual. Vamos a utilizar </span><code>Sequelize</code><span> para importar todos los modelos y ponerlos a disposición en nuestro objeto </span><code>db</code><span>.</span></p></li>
<li><p><span>El objeto </span><code>db</code><span> se va a exportar y contendrá nuestros métodos de base de datos para cada modelo; estará disponible en nuestra aplicación cuando tengamos que hacer algo con nuestros datos.</span></p></li>
<li><p><span>Para cargar todos los modelos, en lugar de definirlos manualmente, buscamos todos los archivos dentro del directorio </span><code>models</code><span> (con la excepción del archivo </span><code>index.js</code><span>) y los cargamos usando la función </span><code>require</code><span>. El objeto devuelto nos proporcionará los métodos CRUD, que luego agregaremos al objeto </span><code>db</code><span>.</span></p></li>
<li><p><span>Al final, agregamos las propiedades </span><code>sequelize</code><span> y </span><code>Sequelize</code><span> a nuestro objeto </span><code>db</code><span>. El primero se usa en nuestro servidor </span><code>server.js</code><span> para una base de datos antes de iniciar el servidor, y el segundo se incluye para tu comodidad.</span></p></li>
</ol>
<h2 id="heading-9">
<a name="7-creando-nuestro-modelo-de-nota" class="md-header-anchor"></a><span>7 Creando nuestro modelo de nota</span>
</h2>
<p><span>En esta sección, vamos a utilizar el paquete </span><code>Moment.js</code><span> para ayudar con el formato de fecha. Puedes instalarlo e incluirlo como una dependencia con el siguiente comando:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">npm install -s moment</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>Ahora, vamos a crear un archivo </span><code>note.js</code><span> dentro del directorio </span><code>models</code><span>, que será el único modelo en nuestra aplicación. Nos proporcionará toda la funcionalidad que necesitamos.</span></p>
<p><span>Agrega el siguiente contenido a ese archivo:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99609px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Moment</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'moment'</span>);</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">module</span>.<span class="cm-property">exports</span> <span class="cm-operator">=</span> (<span class="cm-def">sequelize</span>, <span class="cm-def">DataTypes</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">const</span> <span class="cm-def">Note</span> <span class="cm-operator">=</span> <span class="cm-variable-2">sequelize</span>.<span class="cm-property">define</span>(<span class="cm-string">'Note'</span>, {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-property">date</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-property">type</span>: <span class="cm-variable-2">DataTypes</span>.<span class="cm-property">DATE</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-property">get</span>() {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                <span class="cm-keyword">return</span> <span class="cm-variable">Moment</span>(<span class="cm-keyword">this</span>.<span class="cm-property">getDataValue</span>(<span class="cm-string">'date'</span>)).<span class="cm-property">format</span>(<span class="cm-string">'MMMM Do, YYYY'</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-property">title</span>: <span class="cm-variable-2">DataTypes</span>.<span class="cm-property">STRING</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-property">slug</span>: <span class="cm-variable-2">DataTypes</span>.<span class="cm-property">STRING</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-property">description</span>: <span class="cm-variable-2">DataTypes</span>.<span class="cm-property">STRING</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-property">content</span>: <span class="cm-variable-2">DataTypes</span>.<span class="cm-property">STRING</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    });</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">return</span> <span class="cm-variable-2">Note</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 368px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 368px;"></div>
</div>
</div></pre>
<ol start="">
<li>
<span>Exportamos una función que acepta una instancia </span><code>sequelize</code><span>, para definir el modelo y un objeto </span><code>DataTypes</code><span> con todos los tipos disponibles en nuestra base de datos.</span>
</li>
<li>
<span>A continuación, definimos la estructura de nuestros datos utilizando un objeto donde cada clave corresponde a una columna de base de datos y el valor de la clave define el tipo de datos que vamos a almacenar. Puedes ver la lista de tipos de datos en la </span><a href="http://docs.sequelizejs.com/variable/index.html#static-variable-DataTypes"><span>documentación de Sequelize.js</span></a><span>. Las tablas en la base de datos se crearán automáticamente en función de esta información.</span>
<span>En el caso de la columna de fecha, también definimos cómo </span><code>Sequelize</code><span> debería devolver el valor utilizando una función </span><code>getter</code><span> (get key). Indicamos que antes de devolver la información, primero se debe pasar a través de la utilidad </span><code>Moment</code><span> para que se formatee de una manera más legible (MMMM Do, YYYY).</span>
</li>
<li>
<span>Finalmente, devolvemos el modelo (</span><code>Note</code><span>).</span>
</li>
</ol>
<p><span>Ahora que hemos terminado nuestros modelos, a continuación, sincronizaremos nuestra base de datos para que podamos usarla en la aplicación.</span></p>
<h2 id="heading-10">
<a name="8-sincronizar-la-base-de-datos" class="md-header-anchor"></a><span>8 Sincronizar la base de datos</span>
</h2>
<p><span>Ahora, tenemos que sincronizar nuestra base de datos antes de poder utilizarla en nuestra aplicación. En </span><code>server.js</code><span>, importa los modelos en la parte superior del archivo:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99707px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Models</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'./lib/models/'</span>);</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>A continuación, envuelve (wrap) el siguiente método de llamada:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99741px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">init</span>();</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>con una llamada a </span><code>Models.sequelize.sync</code><span>, así:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99707px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Models</span>.<span class="cm-property">sequelize</span>.<span class="cm-property">sync</span>().<span class="cm-property">then</span>(() <span class="cm-operator">=&gt;</span> {</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">init</span>();</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">});</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 76px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 76px;"></div>
</div>
</div></pre>
<p><span>Este código sincronizará los modelos con nuestra base de datos y, una vez hecho esto, el método </span><code>init</code><span> iniciará todo. Hacer las cosas de esta manera significa que no saturamos la aplicación mientras utilizamos las funciones de </span><code>Sequelize</code><span>.</span></p>
<h2 id="heading-11">
<a name="9-crear-los-controladores" class="md-header-anchor"></a><span>9 Crear los controladores</span>
</h2>
<p><span>Los controladores son funciones que aceptan el objeto </span><code>request</code><span> y el </span><code>response tool kit</code><span> de Hapi.js. El objeto </span><code>request</code><span> contiene información sobre el recurso solicitado y usamos métodos del kit de herramientas de respuesta para devolver información al cliente.</span></p>
<p><span>En nuestra aplicación, vamos a devolver solo un objeto JSON por ahora, pero agregaremos las vistas una vez que las construyamos.</span></p>
<p><span>Podemos pensar en los controladores como funciones que unirán nuestros modelos con nuestros puntos de vista; se comunicarán con nuestros modelos para obtener los datos y luego los devolverán dentro de una vista.</span></p>
<h3 id="heading-12">
<a name="91-el-controlador-home" class="md-header-anchor"></a><span>9.1 El controlador Home</span>
</h3>
<p><span>El primer controlador que vamos a construir manejará la página de inicio de nuestro sitio.</span></p>
<p><span>Crea un directorio </span><code>lib/controllers</code><span> con un archivo </span><code>home.js</code><span> dentro, luego agrega el siguiente contenido:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Models</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'../models/'</span>);</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">module</span>.<span class="cm-property">exports</span> <span class="cm-operator">=</span> <span class="cm-keyword">async</span> (<span class="cm-def">request</span>, <span class="cm-def">h</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">const</span> <span class="cm-def">notes</span> <span class="cm-operator">=</span> <span class="cm-keyword">await</span> <span class="cm-variable">Models</span>.<span class="cm-property">Note</span>.<span class="cm-property">findAll</span>({</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-property">order</span>: [[<span class="cm-string">'date'</span>, <span class="cm-string">'DESC'</span>]],</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    });</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">return</span> { <span class="cm-property">notes</span> };</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 166px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 166px;"></div>
</div>
</div></pre>
<ol start="">
<li>
<span>Obtenemos todas las notas en nuestra base de datos utilizando el método </span><code>findAll</code><span> de nuestro modelo.</span>
<span>Esta función devolverá una promesa que, cuando se resuelva, nos dará un array que contiene todas las notas en nuestra base de datos.</span>
<span>Podemos organizar los resultados en orden descendente, usando el parámetro de orden en el objeto de opciones pasado al método </span><code>findAll</code><span>, de modo que el primer elemento aparezca primero. Puedes consultar todas las opciones disponibles en la documentación de Sequelize.js.</span>
</li>
<li><span>Finalmente devolvemos un objeto que contiene una propiedad de nota, cuyo valor es nuestro array de notas.</span></li>
</ol>
<p><span>Una vez que tengamos el controlador </span><code>Home</code><span>, podemos editar nuestro archivo </span><code>routes.js</code><span>. Primero, importamos el módulo en la parte superior del archivo, junto con el módulo </span><code>Path</code><span>:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Path</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'path'</span>);</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//Home es el nombre usado después en el handler de la ruta</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Home</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'./controllers/home'</span>);</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 76px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 76px;"></div>
</div>
</div></pre>
<p><span>Luego agregamos el controlador que acabamos de hacer al array:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99707px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    {</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">method</span>: <span class="cm-string">'GET'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">path</span>: <span class="cm-string">'/'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">handler</span>: <span class="cm-variable">Home</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">config</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-variable">description</span>: <span class="cm-string">'Gets all the notes available'</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 188px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 188px;"></div>
</div>
</div></pre>
<p><span>Para comprobar que todo es correcto, visita la página </span><a href="http://localhost:3000" target="_blank" class="url">http://localhost:3000</a><span>. El resultado será un </span><code>json</code><span> vacío: </span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="json"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="json">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99744px; left: 3.99738px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{<span class="cm-string cm-property">"notes"</span>:[]}</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<h3 id="heading-13">
<a name="92-controlador-para-las-notas" class="md-header-anchor"></a><span>9.2 Controlador para las Notas</span>
</h3>
<p><span>Instalaremos el módulo </span><code>slugify</code><span>.</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99707px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">npm install -s slugify</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>El último controlador que tenemos que definir en nuestra aplicación nos permitirá crear, leer, actualizar y eliminar notas.</span></p>
<p><span>Podemos proceder a crear un archivo </span><code>note.js</code><span> dentro del directorio </span><code>lib/controllers</code><span> y agregar el siguiente contenido:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99707px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Path</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'path'</span>);</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Slugify</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'slugify'</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Models</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'../models/'</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">module</span>.<span class="cm-property">exports</span> <span class="cm-operator">=</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">// Here we're going to include our functions that will handle each request</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">// in the routes.js file.</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 166px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 166px;"></div>
</div>
</div></pre>
<h4 id="heading-14">
<a name="921-create" class="md-header-anchor"></a><span>9.2.1 </span><code>Create</code>
</h4>
<p><span>Para agregar una nota a nuestra base de datos, vamos a escribir una función de creación que incluirá el método de creación en nuestro modelo utilizando los datos contenidos en el objeto </span><code>payload</code><span> (payload son los datos enviados en la petición, por ejemplo, de un formulario).</span></p>
<p><span>Modifica </span><code>note.js</code><span>, para exportar el método </span><code>create</code><span>:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">Path</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'path'</span>);</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">Slugify</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'slugify'</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">Models</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'../models/'</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">module</span>.<span class="cm-variable">exports</span> <span class="cm-operator">=</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">// Here we're going to include our functions that will handle each request</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">// in the routes.js file.</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">create</span>: <span class="cm-variable">async</span> (<span class="cm-variable">request</span>, <span class="cm-variable">h</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">const</span> <span class="cm-variable">note</span> <span class="cm-operator">=</span> <span class="cm-variable">await</span> <span class="cm-variable">Models</span>.<span class="cm-variable">Note</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            .<span class="cm-variable">create</span>({</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                <span class="cm-variable">date</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                <span class="cm-variable">title</span>: <span class="cm-variable">request</span>.<span class="cm-variable">payload</span>.<span class="cm-variable">noteTitle</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                <span class="cm-variable">slug</span>: <span class="cm-variable">Slugify</span>(<span class="cm-variable">request</span>.<span class="cm-variable">payload</span>.<span class="cm-variable">noteTitle</span>, { <span class="cm-variable">lower</span>: <span class="cm-atom">true</span> }),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                <span class="cm-variable">description</span>: <span class="cm-variable">request</span>.<span class="cm-variable">payload</span>.<span class="cm-variable">noteDescription</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                <span class="cm-variable">content</span>: <span class="cm-variable">request</span>.<span class="cm-variable">payload</span>.<span class="cm-variable">noteContent</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            });</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">return</span> { <span class="cm-variable">note</span> }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 413px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 413px;"></div>
</div>
</div></pre>
<p><span>Ahora vamos a incluir este archivo en </span><code>routes.js</code><span> y a modificar el controlador. Añade la siguiente línea al principio del archivo.</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">Note</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'./controllers/note'</span>)</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>Y ahora modifica el </span><code>handler</code><span> para el método </span><code>POST</code><span> y ruta </span><code>note</code><span>:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    {</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">method</span>: <span class="cm-string">'POST'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">path</span>: <span class="cm-string">'/note'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">handler</span>: <span class="cm-variable">Note</span>.<span class="cm-property">create</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">config</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-variable">description</span>: <span class="cm-string">'Adds a new note'</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 188px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 188px;"></div>
</div>
</div></pre>
<blockquote>
<p><strong><span>IMPORTANTE</span></strong></p>
<p><span>Cada vez que modifiques código, recuerda reiniciar la aplicación. También se puede instalar el módulo </span><a href="https://www.npmjs.com/package/nodemon"><span>nodemon</span></a><span> que lo hace automáticamente por ti cada vez que guardas un archivo.</span></p>
</blockquote>
<p><strong><span>Prueba de esta ruta.</span></strong></p>
<p><span>Para comprobar que podemos crear nuevas rutas, vamos a usar </span><a href="https://www.getpostman.com/"><span>Postman</span></a><span>. Los datos que espera recibir son: </span><code>noteTitle</code><span>, </span><code>noteDescription</code><span> y </span><code>noteContent</code><span>, como podemos ver dentro del método </span><code>create</code></p>
<p><span>En Postman, crea un nuevo </span><code>Request</code><span> y configúralo para enviar los datos. Si todo va bien, te debe devolver un objeto json con la nota recién creada.</span></p>
<p><img src="assets/1549366843137.png" referrerpolicy="no-referrer" alt="1549366843137"></p>
<p><span>Fijaos que os crea automáticamente un </span><em><span>slug</span></em><span> para vuestra nueva nota.</span></p>
<p><span>Si ahora visitas </span><a href="http://localhost:3000" target="_blank" class="url">http://localhost:3000</a><span>, verás que ya devuelve esta nota:</span></p>
<p><img src="assets/1549367312494.png" referrerpolicy="no-referrer" alt="1549367312494"></p>
<h4 id="heading-15">
<a name="922-read" class="md-header-anchor"></a><span>9.2.2 </span><code>Read</code>
</h4>
<p><span>Vamos a crear la función </span><code>read</code><span>,  en </span><code>note.js</code><span>, que devolverá aquella nota cuyo </span><code>slug</code><span> sea el pasado como parámetro. En el caso del creado en el ejemplo, el slug será </span><code>primera-nota</code><span>. Para ello usamos el método </span><code>findOne</code></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99707px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">read</span>: <span class="cm-keyword">async</span> (<span class="cm-def">request</span>, <span class="cm-def">h</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">const</span> <span class="cm-def">note</span> <span class="cm-operator">=</span> <span class="cm-keyword">await</span> <span class="cm-variable">Models</span>.<span class="cm-property">Note</span>.<span class="cm-property">findOne</span>({</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-property">where</span>: { <span class="cm-property">slug</span>: <span class="cm-variable-2">request</span>.<span class="cm-property">params</span>.<span class="cm-property">slug</span> },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        });</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">return</span> { <span class="cm-property">note</span> };</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 143px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 143px;"></div>
</div>
</div></pre>
<p><span>Y ahora modificamos </span><code>routes.js</code><span> para cambiar el </span><code>handler</code><span> por </span><code>Note.read</code><span>:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    {</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">method</span>: <span class="cm-string">'GET'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">path</span>: <span class="cm-string">'/note/{slug}'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">handler</span>: <span class="cm-variable">Note</span>.<span class="cm-property">read</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">config</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-variable">description</span>: <span class="cm-string">'Gets the content of a note'</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 188px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 188px;"></div>
</div>
</div></pre>
<p><span>Si ahora, accedemos a </span><a href="http://localhost:3000/note/primera-nota" target="_blank" class="url">http://localhost:3000/note/primera-nota</a><span>, veréis que </span><strong><span>no devuelve nada!</span></strong><span>.</span></p>
<p><img src="assets/1549368440460.png" referrerpolicy="no-referrer" alt="1549368440460"></p>
<p><span>Esto es así porque estamos guardando los datos en memoria y cada vez que reiniciamos, se pierden.</span>
<span>En el archivo </span><code>settings.js</code><span> se configura la base de datos en </span><code>development</code><span>como </span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="sqlite"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="sqlite">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.9974px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">storage: <span class="cm-string">':memory:'</span></span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>Vamos a modificarlo para que guarde la base de datos en un archivo físico que dejaremos en </span><code>db/notes.db</code></p>
<p><span>Primero creamos el directorio </span><code>db</code><span> y dentro de él ejecutamos </span><code>sqlite3 notes.db</code></p>
<p><span>Y modificamos el parámetro </span><code>storage</code><span>:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="sqlite"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="sqlite">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99738px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">storage: <span class="cm-string">'db/notes.db'</span>,</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>Ahora ya podéis volver a realizar la petición </span><code>POST</code><span> desde Postman para que los datos se persistan en la base de datos y poder mantenerlos entre reinicios del servidor.</span></p>
<p><img src="assets/1549367909233.png" referrerpolicy="no-referrer" alt="1549367909233"></p>
<h4 id="heading-16">
<a name="923-update" class="md-header-anchor"></a><span>9.2.3 </span><code>Update</code>
</h4>
<p><span>Para actualizar una nota, usamos el método de actualización en nuestro modelo. Se necesitan dos objetos, los nuevos valores que vamos a reemplazar y las opciones que contienen un filtro </span><code>where</code><span> con el slug de nota (que identifica la nota que vamos a actualizar).</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99707px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">update</span>: <span class="cm-keyword">async</span> (<span class="cm-def">request</span>, <span class="cm-def">h</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">const</span> <span class="cm-def">values</span> <span class="cm-operator">=</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-property">title</span>: <span class="cm-variable-2">request</span>.<span class="cm-property">payload</span>.<span class="cm-property">noteTitle</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-property">description</span>: <span class="cm-variable-2">request</span>.<span class="cm-property">payload</span>.<span class="cm-property">noteDescription</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-property">content</span>: <span class="cm-variable-2">request</span>.<span class="cm-property">payload</span>.<span class="cm-property">noteContent</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        };</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">const</span> <span class="cm-def">options</span> <span class="cm-operator">=</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-property">where</span>: { <span class="cm-property">slug</span>: <span class="cm-variable-2">request</span>.<span class="cm-property">params</span>.<span class="cm-property">slug</span> },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        };</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">await</span> <span class="cm-variable">Models</span>.<span class="cm-property">Note</span>.<span class="cm-property">update</span>(<span class="cm-variable-2">values</span>, <span class="cm-variable-2">options</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">const</span> <span class="cm-def">note</span> <span class="cm-operator">=</span> <span class="cm-keyword">await</span> <span class="cm-variable">Models</span>.<span class="cm-property">Note</span>.<span class="cm-property">findOne</span>(<span class="cm-variable-2">options</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">return</span> { <span class="cm-property">note</span> };</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 301px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 301px;"></div>
</div>
</div></pre>
<p><span>Modificamos de nuevo </span><code>routes.js</code><span> para cambiar el </span><code>handler</code><span> por </span><code>Note.update</code></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99707px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    {</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">method</span>: <span class="cm-string">'PUT'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">path</span>: <span class="cm-string">'/note/{slug}'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">handler</span>: <span class="cm-variable">Note</span>.<span class="cm-property">update</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">config</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-variable">description</span>: <span class="cm-string">'Updates the selected note'</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 188px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 188px;"></div>
</div>
</div></pre>
<p><span>Vamos a crear otra </span><code>Request</code><span> en Postman con el método </span><code>PUT</code><span>:</span></p>
<p><span>La ruta debe ser, </span><a href="http://localhost:3000/note/primera-nota" target="_blank" class="url">http://localhost:3000/note/primera-nota</a></p>
<p><span>Y este es el resultado:</span></p>
<p><img src="assets/1549369376464.png" referrerpolicy="no-referrer" alt="1549369376464"></p>
<p> </p>
<h4 id="heading-17">
<a name="924-delete" class="md-header-anchor"></a><span>9.2.4 </span><code>Delete</code>
</h4>
<p><span>El controlador para </span><code>delete</code><span> eliminará la nota al proporcionar el slug al método </span><code>destroy</code><span> de nuestro modelo.</span></p>
<p><span>Y devolverá una cadena vacía.</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99707px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">delete</span>: <span class="cm-keyword">async</span> (<span class="cm-def">request</span>, <span class="cm-def">h</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">await</span> <span class="cm-variable">Models</span>.<span class="cm-property">Note</span>.<span class="cm-property">destroy</span>({ <span class="cm-property">where</span>: { <span class="cm-property">slug</span>: <span class="cm-variable-2">request</span>.<span class="cm-property">params</span>.<span class="cm-property">slug</span> } });</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">return</span> {};</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 98px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 98px;"></div>
</div>
</div></pre>
<p><span>Y modificamos el </span><code>handler</code><span>, para que use </span><code>Note.delete</code></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    {</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">method</span>: <span class="cm-string">'DELETE'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">path</span>: <span class="cm-string">'/note/{slug}'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">handler</span>: <span class="cm-variable">Note</span>.<span class="cm-property">delete</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">config</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-variable">description</span>: <span class="cm-string">'Deletes the selected note'</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 188px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 188px;"></div>
</div>
</div></pre>
<p><span>Y lo volvemos probar con Postman</span></p>
<p><img src="assets/1549369832011.png" referrerpolicy="no-referrer" alt="1549369832011"></p>
<h2 id="heading-18">
<a name="10-crear-las-vistas" class="md-header-anchor"></a><span>10 Crear las vistas</span>
</h2>
<p><span>En este punto, nuestro sitio recibe llamadas </span><code>HTTP</code><span> y responde con objetos </span><code>JSON</code><span>.</span>
<span>Para que sea útil para todos, tenemos que crear las páginas que representan nuestra información de una manera agradable.</span></p>
<p><span>En este ejemplo, vamos a utilizar el lenguaje de plantillas </span><code>Pug</code><span>, aunque esto no es obligatorio y podemos usar </span><a href="https://hapijs.com/tutorials/views"><span>otros lenguajes</span></a><span> con Hapi.js. Además, vamos a utilizar el plugin </span><a href="https://github.com/hapijs/vision"><span>Vision</span></a><span> para habilitar la funcionalidad de visualización en nuestro servidor.</span></p>
<blockquote>
<p><strong><span>Pug</span></strong></p>
<p><span>Si no estás familiarizado con Pug (anteriormente Jade), consulta el </span><a href="https://www.sitepoint.com/jade-tutorial-for-beginners/"><span>tutorial de Jade</span></a><span> para principiantes</span></p>
</blockquote>
<p><span>Puedes instalar los paquetes mediante:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99805px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">npm install -s vision@5 pug</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<h3 id="heading-19">
<a name="101-el-componente-note" class="md-header-anchor"></a><span>10.1 El componente Note</span>
</h3>
<p><span>Primero, vamos a construir nuestro componente de notas que se reutilizará en nuestras vistas. Además, vamos a utilizar este componente en algunas de nuestras funciones de controlador para crear una nota sobre la marcha en el back-end. Esto simplificará la lógica en el cliente.</span></p>
<p><span>Crea un archivo en </span><code>lib/views/partials</code><span> llamado </span><code>note.pug</code><span> con el siguiente contenido:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="jade"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="jade">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99707px; left: 3.99738px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">a</span><span class="cm-property">rticle</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">  h2</span><span class="cm-atom">:</span> a<span class="cm-def">(</span><span class="cm-property">href</span><span class="cm-atom">=</span><span class="cm-string">'note/'</span> <span class="cm-atom">+</span> <span class="cm-property">note</span><span class="cm-keyword">.</span><span class="cm-property">slug</span><span class="cm-def">)</span><span class="cm-atom">=</span>note<span class="cm-keyword">.</span><span class="cm-property">title</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">small</span> Published on <span class="cm-keyword">#{</span><span class="cm-property">note</span><span class="cm-keyword">.</span><span class="cm-property">date</span><span class="cm-keyword">}</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">  p</span><span class="cm-atom">=</span> note<span class="cm-keyword">.</span><span class="cm-property">content</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">  p</span> This will be safe<span class="cm-atom">:</span> <span class="cm-keyword">#{</span><span class="cm-property">note</span><span class="cm-keyword">.</span><span class="cm-property">slug</span><span class="cm-keyword">}</span></span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 122px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 122px;"></div>
</div>
</div></pre>
<p><span>Está compuesto por el título de la nota, la fecha de publicación y el contenido de la nota.</span></p>
<blockquote><p><strong><span>Cuidado</span></strong><span>: Pug es sensible al espacio en blanco/sangría.</span></p></blockquote>
<h3 id="heading-20">
<a name="102-el-layout-base" class="md-header-anchor"></a><span>10.2 El layout base</span>
</h3>
<p><span>El diseño base contiene los elementos comunes de nuestras páginas; O en otras palabras, para nuestro ejemplo, todo lo que no es contenido. Crea un archivo en </span><code>lib/views/</code><span> llamado </span><code>layout.pug</code><span> con el siguiente contenido:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="jade" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="jade">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99756px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">doctype </span><span class="cm-property">html</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">html</span><span class="cm-def">(</span><span class="cm-property">lang</span><span class="cm-atom">=</span><span class="cm-string">'en'</span><span class="cm-def">)</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">  head</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    meta</span><span class="cm-def">(</span><span class="cm-property">charset</span><span class="cm-atom">=</span><span class="cm-string">'utf-8'</span><span class="cm-def">)</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    meta</span><span class="cm-def">(</span><span class="cm-property">http-equiv</span><span class="cm-atom">=</span><span class="cm-string">'x-ua-compatible'</span> <span class="cm-property">content</span><span class="cm-atom">=</span><span class="cm-string">'ie=edge'</span><span class="cm-def">)</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    title</span><span class="cm-atom">=</span> page</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    meta</span><span class="cm-def">(</span><span class="cm-property">name</span><span class="cm-atom">=</span><span class="cm-string">'description'</span> <span class="cm-property">content</span><span class="cm-atom">=</span><span class="cm-property">description</span><span class="cm-def">)</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    meta</span><span class="cm-def">(</span><span class="cm-property">name</span><span class="cm-atom">=</span><span class="cm-string">'viewport'</span> <span class="cm-property">content</span><span class="cm-atom">=</span><span class="cm-string">'width=device-width, initial-scale=1'</span><span class="cm-def">)</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    link</span><span class="cm-def">(</span><span class="cm-property">href</span><span class="cm-atom">=</span><span class="cm-string">'https://fonts.googleapis.com/css?family=Gentium+Book+Basic:400,400i,700,700i|Ubuntu:500'</span> <span class="cm-property">rel</span><span class="cm-atom">=</span><span class="cm-string">'stylesheet'</span><span class="cm-def">)</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    link</span><span class="cm-def">(</span><span class="cm-property">rel</span><span class="cm-atom">=</span><span class="cm-string">'stylesheet'</span> <span class="cm-property">href</span><span class="cm-atom">=</span><span class="cm-string">'/styles/main.css'</span><span class="cm-def">)</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">  body</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">block</span> content</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    script</span><span class="cm-def">(</span><span class="cm-property">src</span><span class="cm-atom">=</span><span class="cm-string">'/scripts/jquery.min.js'</span><span class="cm-def">)</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    script</span><span class="cm-def">(</span><span class="cm-property">src</span><span class="cm-atom">=</span><span class="cm-string">'/scripts/jquery.modal.min.js'</span><span class="cm-def">)</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    script</span><span class="cm-def">(</span><span class="cm-property">src</span><span class="cm-atom">=</span><span class="cm-string">'/scripts/main.js'</span><span class="cm-def">)</span></span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 413px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 413px;"></div>
</div>
</div></pre>
<p><span>El contenido de las otras páginas se cargará en lugar del contenido </span><code>block</code><span>. Además, ten en cuenta que mostraremos una variable </span><code>page</code><span> en el elemento </span><code>title</code><span> y una variable </span><code>description</code><span> en el elemento </span><code>meta (nombre = 'description')</code><span>. Vamos a crear esas variables en nuestras rutas más adelante.</span></p>
<p><span>También incluimos, un archivo CSS en la parte superior de la página, así como tres archivos JS en la parte inferior. Estos son jQuery, jQuery Modal y un archivo </span><code>main.js</code><span> que contendrá todo nuestro código JS personalizado para el front-end. Asegúrate de descargar todos estos archivos (</span><code>static.zip</code><span>) desde el aula virtual y colocarlos en la carpeta correcta dentro del directorio </span><code>static/public/</code><span>.</span></p>
<p><span>Vamos a hacerlos públicos en breve, en la sección </span><a href="#servir-archivos-est%C3%A1ticos"><span>Servir archivos estáticos</span></a><span>.</span></p>
<h3 id="heading-21">
<a name="103-la-vista-home" class="md-header-anchor"></a><span>10.3 La vista Home</span>
</h3>
<p><img src="assets/1565631048326.png" referrerpolicy="no-referrer"></p>
<p><span>En nuestra página de inicio, mostraremos una lista con todas las notas en nuestra base de datos y un botón que mostrará una ventana modal con un formulario que nos permite crear una nueva nota a través de Ajax.</span>
<span>Crea un archivo en </span><code>lib/views</code><span> llamado </span><code>home.pug</code><span> con el siguiente contenido:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="jade" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="jade">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99756px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre>x</pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">extends layout</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">block content</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">  head</span><span class="cm-property">er</span><span class="cm-def">(</span><span class="cm-property">container</span><span class="cm-def">)</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    h1</span> Notes Board</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    nav</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      ul</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        li<span class="cm-atom">:</span> a<span class="cm-def">(</span><span class="cm-property">href</span><span class="cm-atom">=</span><span class="cm-string">'#note-form'</span> <span class="cm-property">rel</span><span class="cm-atom">=</span><span class="cm-string">'modal:open'</span><span class="cm-def">)</span> Publish</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  main<span class="cm-def">(</span><span class="cm-property">container</span><span class="cm-def">)</span><span class="cm-keyword">.</span><span class="cm-property">notes-list</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">    each </span><span class="cm-property">note</span><span class="cm-keyword"> in </span><span class="cm-property">data</span><span class="cm-keyword">.</span><span class="cm-property">notes</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">      include </span><span class="cm-property">partials</span><span class="cm-atom">/</span>note</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  form<span class="cm-def">(</span><span class="cm-property">action</span><span class="cm-atom">=</span><span class="cm-string">'/note'</span> <span class="cm-property">method</span><span class="cm-atom">=</span><span class="cm-string">'POST'</span><span class="cm-def">)</span><span class="cm-keyword">.</span><span class="cm-property">note-form</span><span class="cm-keyword">#</span><span class="cm-property">note-form</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    p</span><span class="cm-atom">:</span> input<span class="cm-def">(</span><span class="cm-property">name</span><span class="cm-atom">=</span><span class="cm-string">'noteTitle'</span> <span class="cm-property">type</span><span class="cm-atom">=</span><span class="cm-string">'text'</span> <span class="cm-property">placeholder</span><span class="cm-atom">=</span><span class="cm-string">'Title…'</span><span class="cm-def">)</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    p</span><span class="cm-atom">:</span> input<span class="cm-def">(</span><span class="cm-property">name</span><span class="cm-atom">=</span><span class="cm-string">'noteDescription'</span> <span class="cm-property">type</span><span class="cm-atom">=</span><span class="cm-string">'text'</span> <span class="cm-property">placeholder</span><span class="cm-atom">=</span><span class="cm-string">'Short description…'</span><span class="cm-def">)</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    p</span><span class="cm-atom">:</span> textarea<span class="cm-def">(</span><span class="cm-property">name</span><span class="cm-atom">=</span><span class="cm-string">'noteContent'</span> <span class="cm-property">placeholder</span><span class="cm-atom">=</span><span class="cm-string">'Write the content of the new note here…'</span><span class="cm-def">)</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    p</span><span class="cm-keyword">.</span><span class="cm-property">_text-right</span><span class="cm-atom">:</span> input<span class="cm-def">(</span><span class="cm-property">type</span><span class="cm-atom">=</span><span class="cm-string">'submit'</span> <span class="cm-property">value</span><span class="cm-atom">=</span><span class="cm-string">'Submit'</span><span class="cm-def">)</span></span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 458px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 458px;"></div>
</div>
</div></pre>
<p><span>Y ahora sólo queda modificar el controlador </span><code>home.js</code><span> </span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99707px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">Models</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'../models/'</span>);</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">module</span>.<span class="cm-variable">exports</span> <span class="cm-operator">=</span> <span class="cm-variable">async</span> (<span class="cm-variable">request</span>, <span class="cm-variable">h</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">const</span> <span class="cm-variable">notes</span> <span class="cm-operator">=</span> <span class="cm-variable">await</span> <span class="cm-variable">Models</span>.<span class="cm-variable">Note</span>.<span class="cm-variable">findAll</span>({</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">order</span>: [[<span class="cm-string">'date'</span>, <span class="cm-string">'DESC'</span>]],</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    });</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">return</span> <span class="cm-variable">h</span>.<span class="cm-variable">view</span>(<span class="cm-string">'home'</span>, {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">data</span>: { <span class="cm-variable">notes</span> },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">page</span>: <span class="cm-string">'Home—Notes Board'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">description</span>: <span class="cm-string">'Welcome to my Notes Board'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    });</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 278px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 278px;"></div>
</div>
</div></pre>
<p> </p>
<h3 id="heading-22">
<a name="104-la-vista-note" class="md-header-anchor"></a><span>10.4 La vista Note</span>
</h3>
<p><img src="assets/1565631127987.png" referrerpolicy="no-referrer" alt="1565631127987"></p>
<p><span>La página de notas es bastante similar a la página de inicio, pero en este caso, mostramos un menú con opciones específicas a la nota actual, el contenido de la nota y el mismo formulario que en la página de inicio, pero con la información de la nota actual ya rellenada.</span></p>
<p><span>Crea un archivo en </span><code>lib/views</code><span> llamado </span><code>note.pug</code><span> con el siguiente contenido:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="jade" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="jade">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.9974px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre>x</pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">extends layout</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">block content</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">  head</span><span class="cm-property">er</span><span class="cm-def">(</span><span class="cm-property">container</span><span class="cm-def">)</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    h1</span> Notes Board</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    nav</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      ul</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        li<span class="cm-atom">:</span> a<span class="cm-def">(</span><span class="cm-property">href</span><span class="cm-atom">=</span><span class="cm-string">'/'</span><span class="cm-def">)</span> Home</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        li<span class="cm-atom">:</span> a<span class="cm-def">(</span><span class="cm-property">href</span><span class="cm-atom">=</span><span class="cm-string">'#note-form'</span> <span class="cm-property">rel</span><span class="cm-atom">=</span><span class="cm-string">'modal:open'</span><span class="cm-def">)</span> Update</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        li<span class="cm-atom">:</span> a<span class="cm-def">(</span><span class="cm-property">href</span><span class="cm-atom">=</span><span class="cm-property">`</span><span class="cm-atom">/</span><span class="cm-property">note</span><span class="cm-atom">/</span><span class="cm-property">$</span><span class="cm-keyword">{</span><span class="cm-property">note</span><span class="cm-keyword">.</span><span class="cm-property">slug</span><span class="cm-keyword">}</span><span class="cm-atom">/</span><span class="cm-property">delete`</span><span class="cm-def">)</span> Delete</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  main<span class="cm-def">(</span><span class="cm-property">container</span><span class="cm-def">)</span><span class="cm-keyword">.</span><span class="cm-property">note-content</span></span></pre>
<div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">    include </span><span class="cm-property">partials</span><span class="cm-atom">/</span>note</span></pre></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  form<span class="cm-def">(</span><span class="cm-property">action</span><span class="cm-atom">=</span><span class="cm-property">`</span><span class="cm-atom">/</span><span class="cm-property">note</span><span class="cm-atom">/</span><span class="cm-property">$</span><span class="cm-keyword">{</span><span class="cm-property">note</span><span class="cm-keyword">.</span><span class="cm-property">slug</span><span class="cm-keyword">}</span><span class="cm-property">`</span> <span class="cm-property">method</span><span class="cm-atom">=</span><span class="cm-string">'PUT'</span><span class="cm-def">)</span><span class="cm-keyword">.</span><span class="cm-property">note-form</span><span class="cm-keyword">#</span><span class="cm-property">note-form</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    p</span><span class="cm-atom">:</span> input<span class="cm-def">(</span><span class="cm-property">name</span><span class="cm-atom">=</span><span class="cm-string">'noteTitle'</span> <span class="cm-property">type</span><span class="cm-atom">=</span><span class="cm-string">'text'</span> <span class="cm-property">value</span><span class="cm-atom">=</span><span class="cm-property">note</span><span class="cm-keyword">.</span><span class="cm-property">title</span><span class="cm-def">)</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    p</span><span class="cm-atom">:</span> input<span class="cm-def">(</span><span class="cm-property">name</span><span class="cm-atom">=</span><span class="cm-string">'noteDescription'</span> <span class="cm-property">type</span><span class="cm-atom">=</span><span class="cm-string">'text'</span> <span class="cm-property">value</span><span class="cm-atom">=</span><span class="cm-property">note</span><span class="cm-keyword">.</span><span class="cm-property">description</span><span class="cm-def">)</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    p</span><span class="cm-atom">:</span> textarea<span class="cm-def">(</span><span class="cm-property">name</span><span class="cm-atom">=</span><span class="cm-string">'noteContent'</span><span class="cm-def">)</span><span class="cm-atom">=</span> note<span class="cm-keyword">.</span><span class="cm-property">content</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">    p</span><span class="cm-keyword">.</span><span class="cm-property">_text-right</span><span class="cm-atom">:</span> input<span class="cm-def">(</span><span class="cm-property">type</span><span class="cm-atom">=</span><span class="cm-string">'submit'</span> <span class="cm-property">value</span><span class="cm-atom">=</span><span class="cm-string">'Update'</span><span class="cm-def">)</span></span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 458px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 458px;"></div>
</div>
</div></pre>
<p> </p>
<h3 id="heading-23">
<a name="105-javascript-en-el-cliente" class="md-header-anchor"></a><span>10.5 Javascript en el cliente</span>
</h3>
<p><span>Para crear y actualizar notas usamos la funcionalidad Ajax de jQuery.</span></p>
<p><span>Este es el contenido del archivo </span><code>main.js</code><span> que ya os habéis descargado en </span><code>static.zip</code><span>:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99741px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">$noteForm</span> <span class="cm-operator">=</span> <span class="cm-variable">$</span>(<span class="cm-string">'#note-form'</span>);</span></pre>
</div>
<div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">$noteForm</span>.<span class="cm-property">submit</span>(<span class="cm-keyword">function</span> (<span class="cm-def">e</span>) {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable-2">e</span>.<span class="cm-property">preventDefault</span>();</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">var</span> <span class="cm-def">form</span> <span class="cm-operator">=</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">url</span>: <span class="cm-variable">$</span>(<span class="cm-keyword">this</span>).<span class="cm-property">attr</span>(<span class="cm-string">'action'</span>),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">type</span>: <span class="cm-variable">$</span>(<span class="cm-keyword">this</span>).<span class="cm-property">attr</span>(<span class="cm-string">'method'</span>)</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  };</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">$</span>.<span class="cm-property">ajax</span>({</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">url</span>: <span class="cm-variable-2">form</span>.<span class="cm-property">url</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">type</span>: <span class="cm-variable-2">form</span>.<span class="cm-property">type</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">data</span>: <span class="cm-variable">$</span>(<span class="cm-keyword">this</span>).<span class="cm-property">serialize</span>(),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">success</span>: <span class="cm-keyword">function</span> (<span class="cm-def">result</span>) {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-variable">$</span>.<span class="cm-property">modal</span>.<span class="cm-property">close</span>();</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-keyword">if</span> (<span class="cm-variable-2">form</span>.<span class="cm-property">type</span> <span class="cm-operator">===</span> <span class="cm-string">'POST'</span>) {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">$</span>(<span class="cm-string">'.notes-list'</span>).<span class="cm-property">prepend</span>(<span class="cm-variable-2">result</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">$noteForm</span>.<span class="cm-property">find</span>(<span class="cm-string">'input[type=text], textarea'</span>).<span class="cm-property">val</span>(<span class="cm-string">''</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      } <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable-2">form</span>.<span class="cm-property">type</span> <span class="cm-operator">===</span> <span class="cm-string">'PUT'</span>) {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">$</span>(<span class="cm-string">'.note-content'</span>).<span class="cm-property">html</span>(<span class="cm-variable-2">result</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  });</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">});</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 593px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 593px;"></div>
</div>
</div></pre>
<p><span>Cada vez que el usuario envía el formulario en la ventana modal, obtenemos la información de los elementos del formulario y la enviamos a nuestro back-end, dependiendo de la URL de la acción y el método (</span><code>POST</code><span> o </span><code>PUT</code><span>). </span></p>
<p><span>Luego, obtendremos el resultado como un bloque de HTML que contiene nuestros nuevos datos de notas. Cuando agregamos una nota, simplemente la agregaremos a la parte superior de la lista en la página de inicio, y cuando actualizamos una nota reemplazamos el contenido por el nuevo en la vista de notas.</span></p>
<p><span>No actualizamos ninguno de nuestros controladores en este capítulo, por lo que no hay nada nuevo que ver en el navegador.</span></p>
<p><span>Ahora que tenemos todas las vistas configuradas y admitidas por nuestro servidor, agregaremos rápidamente soporte para las vistas en el servidor y nos aseguraremos de que nuestro servidor sirva archivos estáticos.</span></p>
<h2 id="heading-24">
<a name="11-a%C3%B1adir-soporte-para-vistas-en-el-servidor" class="md-header-anchor"></a><span>11 Añadir soporte para vistas en el servidor</span>
</h2>
<p><span>Para utilizar nuestras vistas, debemos incluirlas en nuestros controladores y agregar la configuración requerida.</span>
<span>En nuestro archivo </span><code>server.js</code><span>, importemos la utilidad Node </span><code>Path</code><span>, así como las plugins </span><code>Vision</code><span> y </span><code>Pug</code><span>, que instalamos anteriormente. Agrega lo siguiente a la parte superior del archivo:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99731px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Path</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'path'</span>);</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Pug</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'pug'</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Vision</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'vision'</span>);</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 76px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 76px;"></div>
</div>
</div></pre>
<p><span>Elimina la línea </span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99738px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">server</span>.<span class="cm-property">route</span>(<span class="cm-variable">Routes</span>);</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>Ahora cambia la </span><strong><span>constante</span></strong><span> </span><code>init</code></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 116.497px; left: 73.3333px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre>x</pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">init</span> <span class="cm-operator">=</span> <span class="cm-keyword">async</span> () <span class="cm-operator">=&gt;</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">await</span> <span class="cm-variable">server</span>.<span class="cm-property">register</span>([<span class="cm-variable">Vision</span>]);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">server</span>.<span class="cm-property">views</span>({</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-property">engines</span>: { <span class="cm-property">pug</span>: <span class="cm-variable">Pug</span> },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-property">path</span>: <span class="cm-variable">Path</span>.<span class="cm-property">join</span>(<span class="cm-variable">__dirname</span>, <span class="cm-string">'lib/views'</span>),</span></pre>
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-property">compileOptions</span>: {</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-property">pretty</span>: <span class="cm-atom">false</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-property">isCached</span>: <span class="cm-variable">Settings</span>.<span class="cm-property">env</span> <span class="cm-operator">===</span> <span class="cm-string">'production'</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    });</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">server</span>.<span class="cm-property">route</span>(<span class="cm-variable">Routes</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">await</span> <span class="cm-variable">server</span>.<span class="cm-property">start</span>();</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-string-2">`Server running at: ${</span><span class="cm-variable">server</span>.<span class="cm-property">info</span>.<span class="cm-property">uri</span><span class="cm-string-2">}`</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 323px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 323px;"></div>
</div>
</div></pre>
<p><span>En el código que hemos agregado, primero registramos el complemento </span><code>Vision</code><span> en nuestro servidor Hapi.js, que proporcionará la funcionalidad de visualización. Luego, agregamos la configuración de nuestras vistas, como el motor que vamos a usar y la ruta donde se ubican las vistas. Después de este bloque de código, añadimos nuestras rutas.</span></p>
<p><span>Esto hará que nuestras vistas funcionen en el servidor, pero aún tenemos que declarar la vista que vamos a utilizar para cada ruta.</span></p>
<h3 id="heading-25">
<a name="111-configuraci%C3%B3n-de-la-vista-de-inicio" class="md-header-anchor"></a><span>11.1 Configuración de la vista de inicio</span>
</h3>
<p><span>Abre el archivo </span><code>lib/controllers/home.js</code><span> y </span><strong><span>reemplaza</span></strong><span> </span><code>return {notes};</code><span> con lo siguiente:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99731px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">return</span> <span class="cm-variable">h</span>.<span class="cm-property">view</span>(<span class="cm-string">'home'</span>, {</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">data</span>: { <span class="cm-property">notes</span> },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">page</span>: <span class="cm-string">'Home—Notes Board'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">description</span>: <span class="cm-string">'Welcome to my Notes Board'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">});</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 122px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 122px;"></div>
</div>
</div></pre>
<p><span>Este es el código resultante:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99744px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Models</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'../models/'</span>);</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">module</span>.<span class="cm-property">exports</span> <span class="cm-operator">=</span> <span class="cm-keyword">async</span> (<span class="cm-def">request</span>, <span class="cm-def">h</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">const</span> <span class="cm-def">notes</span> <span class="cm-operator">=</span> <span class="cm-keyword">await</span> <span class="cm-variable">Models</span>.<span class="cm-property">Note</span>.<span class="cm-property">findAll</span>({</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-property">order</span>: [[<span class="cm-string">'date'</span>, <span class="cm-string">'DESC'</span>]],</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    });</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">//return {notes};</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">return</span> <span class="cm-variable-2">h</span>.<span class="cm-property">view</span>(<span class="cm-string">'home'</span>, {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-property">data</span>: { <span class="cm-property">notes</span> },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-property">page</span>: <span class="cm-string">'Home—Notes Board'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-property">description</span>: <span class="cm-string">'Welcome to my Notes Board'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    });</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 278px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 278px;"></div>
</div>
</div></pre>
<p><span>Después de registrar el complemento de </span><code>Vision</code><span>, ahora tenemos un método de visualización disponible en el kit de herramientas de respuesta (</span><code>h</code><span>), lo utilizaremos para seleccionar la vista de inicio en nuestro directorio de vistas y para enviar los datos que se utilizarán al renderizar Las vistas.</span></p>
<p><span>En los datos que proporcionamos a la vista, también incluimos el título de la página y una meta descripción para los motores de búsqueda.</span></p>
<h3 id="heading-26">
<a name="112-configuraci%C3%B3n-de-la-vista-de-notacreate" class="md-header-anchor"></a><span>11.2 Configuración de la vista de Nota:create</span>
</h3>
<p><span>En este momento, cada vez que creamos una nota, recibimos un objeto JSON enviado desde el servidor al cliente. Pero ya que estamos haciendo este proceso a través de Ajax, podemos enviar la nueva nota como HTML listo para ser agregado a la página. Para hacer esto, renderizamos el componente de nota con los datos que tenemos.</span></p>
<p><span>En </span><code>lib/controllers/note.js</code><span>, incluye la librería Pug:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99738px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre>x</pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Pug</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'pug'</span>);</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>Luego, </span><strong><span>reemplaza</span></strong><span> la declaración de retorno del método de creación (</span><code>return {note}</code><span>) con lo siguiente:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99738px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre>x</pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">newNote</span> <span class="cm-operator">=</span> <span class="cm-variable">Pug</span>.<span class="cm-property">renderFile</span>(</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">Path</span>.<span class="cm-property">join</span>(<span class="cm-variable">__dirname</span>, <span class="cm-string">'../views/partials/note.pug'</span>),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    { <span class="cm-property">note</span> },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">return</span> <span class="cm-variable">newNote</span>;</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 122px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 122px;"></div>
</div>
</div></pre>
<h3 id="heading-27">
<a name="113-servir-archivos-est%C3%A1ticos" class="md-header-anchor"></a><span>11.3 Servir archivos estáticos</span>
</h3>
<p><span>Los archivos JavaScript y CSS que estamos usando en el lado del cliente son atendidos por Hapi.js desde el directorio </span><code>static/public/</code><span>. Pero no sucederá automáticamente; tenemos que indicar al servidor que queremos definir esta carpeta como pública. Esto se hace usando el paquete </span><code>Inert</code><span>, que puede instalar con el siguiente comando:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99741px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">npm install -s inert</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>En </span><code>server.js</code><span> importa la biblioteca en la parte superior de la página:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99744px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre>x</pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">Inert</span> <span class="cm-operator">=</span> <span class="cm-variable">require</span>(<span class="cm-string">'inert'</span>);</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>Luego, en la función </span><code>server.register</code><span>, regístralo con Hapi así:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99738px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre>x</pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">await</span> <span class="cm-variable">server</span>.<span class="cm-property">register</span>([ <span class="cm-variable">Vision</span>, <span class="cm-variable">Inert</span> ]);</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 31px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 31px;"></div>
</div>
</div></pre>
<p><span>Ahora tenemos que definir la ruta en la que vamos a proporcionar los archivos estáticos y su ubicación en el sistema de archivos de nuestro servidor. Agrega la siguiente entrada al final del objeto exportado en </span><code>routes.js</code><span>:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99738px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre>x</pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  {</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">// Static files</span></span></pre>
<div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">method</span>: <span class="cm-string">'GET'</span>,</span></pre></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">path</span>: <span class="cm-string">'/{param*}'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">handler</span>: {</span></pre>
<div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-variable">directory</span>: {</span></pre></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">path</span>: <span class="cm-variable">Path</span>.<span class="cm-property">join</span>(<span class="cm-variable">__dirname</span>, <span class="cm-string">'../static/public'</span>),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">config</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-variable">description</span>: <span class="cm-string">'Provides static resources'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  },</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 301px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 301px;"></div>
</div>
</div></pre>
<p><span>Puedes encontrar más información sobre cómo servir contenido estático en la documentación de </span><a href="https://hapijs.com/tutorials/serving-files"><span>Hapi.js</span></a></p>
<h3 id="heading-28">
<a name="114-configuraci%C3%B3n-de-la-vista-de-noteread" class="md-header-anchor"></a><span>11.4 Configuración de la vista de Note:read</span>
</h3>
<p><span>Cuando visitamos una página de notas, deberíamos obtener la plantilla de notas con el contenido de nuestra nota. Para hacer esto, debemos </span><strong><span>reemplazar</span></strong><span> la declaración de retorno del método </span><code>read</code><span> (</span><code>return {note}</code><span>) con lo siguiente:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99707px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre>x</pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">return</span> <span class="cm-variable">h</span>.<span class="cm-property">view</span>(<span class="cm-string">'note'</span>, {</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">note</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">page</span>: <span class="cm-string-2">`${</span><span class="cm-variable">note</span>.<span class="cm-property">title</span><span class="cm-string-2">}—Notes Board`</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">description</span>: <span class="cm-variable">note</span>.<span class="cm-property">description</span>,</span></pre>
<div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">})</span></pre></div>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 122px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 122px;"></div>
</div>
</div></pre>
<h3 id="heading-29">
<a name="115-configuraci%C3%B3n-de-la-vista-de-noteupdate" class="md-header-anchor"></a><span>11.5 Configuración de la vista de Note:update</span>
</h3>
<p><span>Cada vez que actualizamos una nota, responderemos de manera similar a cuando creamos nuevas notas. </span><strong><span>Reemplaza</span></strong><span> la declaración de devolución del método de actualización (</span><code>return {note}</code><span>) con lo siguiente:</span></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99741px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre>x</pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">updatedNote</span> <span class="cm-operator">=</span> <span class="cm-variable">Pug</span>.<span class="cm-property">renderFile</span>(</span></pre>
</div>
<div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">Path</span>.<span class="cm-property">join</span>(<span class="cm-variable">__dirname</span>, <span class="cm-string">'../views/partials/note.pug'</span>),</span></pre></div>
<div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    { <span class="cm-property">note</span> },</span></pre></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">);</span></pre>
<div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">return</span> <span class="cm-variable">updatedNote</span>;</span></pre></div>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 122px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 122px;"></div>
</div>
</div></pre>
<h3 id="heading-30">
<a name="116-configuraci%C3%B3n-de-la-vista-de-notedelete" class="md-header-anchor"></a><span>11.6 Configuración de la vista de Note:delete</span>
</h3>
<p><span>La ruta para borrar, necesita un método </span><code>DELETE</code><span>. Pero para poder hacerlo desde el enlace de la aplicación, lo hemos de hacer por </span><code>GET</code><span>. Otra forma posible sería hacerlo registrando un método para el evento clic en el enlace y en este método usar una petición ajax con </span><code>method DELETE</code><span>.</span></p>
<p><span>Así que definimos una nueva ruta en </span><code>routes.js</code></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99741px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre>x</pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  {</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">method</span>: <span class="cm-string">'GET'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">path</span>: <span class="cm-string">'/note/{slug}/delete'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">handler</span>: <span class="cm-variable">Note</span>.<span class="cm-property">deleteGet</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">config</span>: {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-variable">description</span>: <span class="cm-string">'Deletes the selected note'</span>,</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre>
<div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  },</span></pre></div>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 188px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 188px;"></div>
</div>
</div></pre>
<p><span>Y un nuevo controlador en </span><code>controlles/note.js</code></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 3.99738px; left: 4.16663px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre>x</pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">deleteGet</span>: <span class="cm-keyword">async</span> (<span class="cm-def">request</span>, <span class="cm-def">h</span>) <span class="cm-operator">=&gt;</span> {</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">await</span> <span class="cm-variable">Models</span>.<span class="cm-property">Note</span>.<span class="cm-property">destroy</span>({ <span class="cm-property">where</span>: { <span class="cm-property">slug</span>: <span class="cm-variable-2">request</span>.<span class="cm-property">params</span>.<span class="cm-property">slug</span> } });</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">return</span> <span class="cm-variable-2">h</span>.<span class="cm-property">redirect</span>(<span class="cm-string">'/'</span>);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">},</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 98px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 98px;"></div>
</div>
</div></pre>
<p> </p>
</div>      <div id='custom-footer'>
        <!--put here your custom footer -->
      </div>
    </div>
  </div><!--typora-export-->
</div><!--typora-container-->

<!-- jQuery first, then Bootstrap JS -->
  <script type="text/javascript">
   class TyporaToc {
  constructor (maxHeadingLevel = 6) {
    this.maxHeadingLevel = maxHeadingLevel;
    this.previous = null;
    this.topEl = document.querySelector(".top");
    let headings = "";
    for (let i = 1; i <= this.maxHeadingLevel; i++){
      headings += `h${i},`;
    }
    headings = headings.substr(0, headings.length - 1);
    this.allHeadings = document.querySelectorAll(headings);
    this.allTocAnchors = document.querySelectorAll(".md-toc-content a");
    this.currentTocAnchor = null;
    this.typoraContainer = document.querySelector(".typora-container");
    this.writeEl = document.querySelector("#write");
    this.codeMirrors = document.querySelectorAll('.CodeMirror-code');
    this.navNext = document.querySelector('#nav-next');
    this.navPrevious = document.querySelector('#nav-previous');
    this.typoraMenu = document.querySelector('.typora-menu');
    this.lastScrollTop = 0;
    this.lastActive = null;

    this.initEvents();
  }

  initEvents (){
    let oSelf = this;
    document.querySelector(".top .toogle").addEventListener('click', e => {
      e.preventDefault();
      let el = e.target;
      if (el.matches("i")){
        el = el.parentNode;
      }
      if (el.classList.contains('expanded')){
        oSelf.typoraContainer.classList.add('hide-menu');
      }else{
        oSelf.typoraContainer.classList.remove('hide-menu');
      }
      el.classList.toggle('expanded');
    });
    
    this.allTocAnchors.forEach(function(elem) {
      elem.addEventListener("click", e =>  {
          e.preventDefault();
          oSelf.allTocAnchors.forEach(function(anchor){
            anchor.classList.remove('active');
          })
          elem.classList.add("active");
          oSelf.currentTocAnchor = document.querySelector("[name='" + decodeURI(e.target.href.split("#")[1]) + "']");
          if (!oSelf.currentTocAnchor){
            //Chrome no decodeURI
            oSelf.currentTocAnchor = document.querySelector("[name='" + (e.target.href.split("#")[1]) + "']");
          }
          if (oSelf.currentTocAnchor){
            oSelf.currentTocAnchor.scrollIntoView({ behavior: 'smooth' })
            window.setTimeout(() =>location.hash = e.target.href.split("#")[1],500);
          }
          
      });
    });

    this.topEl.addEventListener('click', e => {
      e.preventDefault();
      
      let el = e.target;
      if (el.matches("i")){
          el = el.parentNode;
      }
      if ((el.getAttribute("id") === "nav-previous") || ((el.getAttribute("id") === "nav-next"))){
          let name =  el.getAttribute('href').split("#")[1];
          if (name !== "")
            location.hash = name;
      }
    });

    window.addEventListener('keydown', function(e) {
      
      if (e.keyCode == 39){
      	e.preventDefault();
        location.hash = oSelf.navNext.getAttribute("href");
      }else if(e.keyCode == 37){
      	e.preventDefault();
        location.hash = oSelf.navPrevious.getAttribute("href");
      }
    });

    window.onload = function(){

      //Add next and previous to headings
      for (let idx = 0; idx < oSelf.allHeadings.length; idx++) {
        let currentHeading = oSelf.allHeadings.item(idx);
        let next;
        
        if (oSelf.allHeadings.item(idx+1)){
          next = oSelf.allHeadings.item(idx+1).getElementsByTagName("a").item(0);
        }
        if (next){
          currentHeading.setAttribute("data-next", next.getAttribute("name"));
        }else{
          currentHeading.setAttribute("data-next", "");
        }
        if (oSelf.previous){
          currentHeading.setAttribute("data-previous", oSelf.previous.getAttribute("name"));
        }else{
          currentHeading.setAttribute("data-previous", "");
        }
        oSelf.previous = currentHeading.getElementsByTagName("a").item(0);
       
      }
    
      //Get hash, if any, to same document
      function getAnchor() {
        var currentUrl = document.URL,
        urlParts   = currentUrl.split('#');
        
        return (urlParts.length > 1) ? urlParts[1] : null;
      }
    
      //Activate link to hash
      let anchor = getAnchor();
    
      let curTocEl =  document.querySelector("[href='" + anchor + "']");
      if (curTocEl)
        curTocEl.classList.add("active");
    
    }

    window.addEventListener('scroll', function(e) {
      var st = window.pageYOffset || document.documentElement.scrollTop; // Credits: "https://github.com/qeremy/so/blob/master/so.dom.js#L426"
        if (st > oSelf.lastScrollTop){
          oSelf.allHeadings.forEach(function(heading) {
            if (oSelf.isAnyPartOfElementInViewport(heading)){
              oSelf.navPrevious.setAttribute("href", "#" + heading.getAttribute("data-previous"));
              oSelf.navNext.setAttribute("href", "#" + heading.getAttribute("data-next"));
              oSelf.typoraMenu.querySelectorAll("a").forEach(function(anchor){
                anchor.classList.remove('active');
              });
              oSelf.lastActive = oSelf.typoraMenu.querySelector( "#anchor-" + heading.getAttribute('id'));
              oSelf.lastActive.classList.add('active');
              if (!oSelf.isAnyPartOfElementInViewport(oSelf.lastActive)){
                oSelf.lastActive.scrollIntoView();
              }
            }
          } 
        );
       } else {
        let notFound = true; 
        oSelf.allHeadings.forEach(function(heading) {
            if (oSelf.isAnyPartOfElementInViewport(heading)){
              oSelf.navPrevious.setAttribute("href", "#" + heading.getAttribute("data-previous"));
              oSelf.navNext.setAttribute("href", "#" + heading.getAttribute("data-next"));
              notFound = false;
              oSelf.typoraMenu.querySelectorAll("a").forEach(function(anchor){
                anchor.classList.remove('active');
              });
              oSelf.lastActive = oSelf.typoraMenu.querySelector( "#anchor-" + heading.getAttribute('id'));
              oSelf.lastActive.classList.add('active');
              if (!oSelf.isAnyPartOfElementInViewport(oSelf.lastActive)){
                oSelf.lastActive.scrollIntoView();
              }
            }
          } 
        );
        if (notFound){
          oSelf.typoraMenu.querySelectorAll("a").forEach(function(anchor){
            anchor.classList.remove('active');
          });
          if (oSelf.lastActive){
            let lastId = oSelf.lastActive.getAttribute("id").split("-")[2] - 1;
            let t = oSelf.typoraMenu.querySelector( "#anchor-heading-" + lastId);
            if (t){
              t.classList.add('active');
              if (!oSelf.isAnyPartOfElementInViewport(t)){
                t.scrollIntoView();
                oSelf.navPrevious.setAttribute("href", "#" + t.getAttribute("data-previous"));
                oSelf.navNext.setAttribute("href", "#" + t.getAttribute("data-next"));
              }
            }
          }
        }
       }
       oSelf.lastScrollTop = st <= 0 ? 0 : st; // For Mobile or negative scrolling
    });
    //In some browsers (Mozilla Firefox), there are some strange characters in codeMirror so if you cut and paste code
    //it doesn't compile because of these characters
    this.codeMirrors.forEach(function(elem) {
      let lines = elem.querySelectorAll('pre > span');
      lines.forEach(function(line){
        line.innerHTML = (line.innerHTML.replace(/[\u0250-\ue007]/g, ''));
        let spans =  line.querySelectorAll("span");
        spans.forEach(function(span){
          span.textContent = (span.textContent.replace(/[\u0250-\ue007]/g, ''));
        });
          
      });
    });

  }

  isAnyPartOfElementInViewport(el) {

    const rect = el.getBoundingClientRect();
    // DOMRect { x: 8, y: 8, width: 100, height: 100, top: 8, right: 108, bottom: 108, left: 8 }
    const windowHeight = (window.innerHeight || document.documentElement.clientHeight);
    const windowWidth = (window.innerWidth || document.documentElement.clientWidth);
    
    // http://stackoverflow.com/questions/325933/determine-whether-two-date-ranges-overlap
    const vertInView = (rect.top <= windowHeight) && ((rect.top + rect.height) >= 0);
    const horInView = (rect.left <= windowWidth) && ((rect.left + rect.width) >= 0);
    
    return (vertInView && horInView);
  }
}
   let toc = new TyporaToc(6);
  </script>
</body>
</html>
